---
title             : "The Bangla Big Five Inventory-2: A Comprehensive Psychmetric Validation using Classical Test Theory and Item Response Theory "
shorttitle        : "GASP"

author: 
  - name          : "Mushfiqul Anwar Siraji"
    affiliation   : "1"
    role:         
      - "Conceptualization"
      - "Writing - Original Draft Preparation"
      - "Writing - Review & Editing"

  - name          : "Shamsul Haque"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Department of Psychology, Jeffrey Cheah School of Medicine and Health Sciences, Monash University Malaysia"
    email         : "my@email.com"

    role:
      - "Writing - Review & Editing"


affiliation:
  - id            : "1"
    institution   : "Department of Psychology, Jeffrey Cheah School of Medicine and Health Sciences, Monash University Malaysia"


authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib", "r-libs.bib"]

floatsintext      : no
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_docx
---

```{r setup-chunk, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = F, message = F, dpi=300)
options(knitr.duplicate.label = "allow")
set.seed(123)
par(family = "Arial")

```

```{r pacman,  include=FALSE}
#You need to run this chunk 1X in your system 
#install.packages("pacman")#Run this if you don't have pacman installed.
# renv::restore()
pacman::p_load(MOTE, tidyverse, psych, lavaan,kableExtra,gt,gtsummary, mirt,likert,kutils,semPlot,semTable,dlookr,VIM,ggplot2,cowplot,questionr,magick, readxl)
library(readxl)
library(gtExtras)
library(papaja)
library(tabledown)
library(semTools)
papaja::r_refs("r-libs.bib")
# renv::snapshot()

#if you dont have LaTeX installed run the following lines
#install.packages("tinytex")
#tinytex::install_tinytex()
```

```{r data, include =F}

data <- readxl::read_excel("Rawdata/Personality Project_December 28, 2022_19.48.xlsx")

# create labels
 var.labes <- data[1,]

 for(i in seq_along(data)){
   Hmisc::label(data[, i]) <- var.labes[1,i]
 }

data <- data[-1,]




# # 7, # 35, 52, 57,
# table(bigfive$Q5.57, data$Q2.6)



data <- data %>% 
  dplyr::select(`Q2.2`:`Q6.49`)

data <- na.omit(data)


## Recoding data$Q2.2 into data$Q2.2
data$Q2.2 <- data$Q2.2
data$Q2.2[data$Q2.2 == "05.10.1976"] <- "46"
data$Q2.2[data$Q2.2 == "15/08/1985"] <- "37"
data$Q2.2[data$Q2.2 == "16"] <- "16"
data$Q2.2[data$Q2.2 == "১৬"] <- "16"
data$Q2.2[data$Q2.2 == "১৭"] <- "17"
data$Q2.2[data$Q2.2 == "১৮"] <- "18"
data$Q2.2[data$Q2.2 == "19"] <- "19"
data$Q2.2[data$Q2.2 == "১৯"] <- "19"
data$Q2.2[data$Q2.2 == "20"] <- "20"
data$Q2.2[data$Q2.2 == "২০"] <- "20"
data$Q2.2[data$Q2.2 == "২১"] <- "21"
data$Q2.2[data$Q2.2 == "21"] <- "21"
data$Q2.2[data$Q2.2 == "২২"] <- "22"
data$Q2.2[data$Q2.2 == "22"] <- "22"
data$Q2.2[data$Q2.2 == "২২ বছর"] <- "22"
data$Q2.2[data$Q2.2 == "23"] <- "23"
data$Q2.2[data$Q2.2 == "২৩"] <- "23"
data$Q2.2[data$Q2.2 == "24"] <- "24"
data$Q2.2[data$Q2.2 == "২৪"] <- "24"
data$Q2.2[data$Q2.2 == "25"] <- "25"
data$Q2.2[data$Q2.2 == "২৫"] <- "25"
data$Q2.2[data$Q2.2 == "26"] <- "26"
data$Q2.2[data$Q2.2 == "২৬"] <- "26"
data$Q2.2[data$Q2.2 == "27"] <- "27"
data$Q2.2[data$Q2.2 == "২৭"] <- "27"
data$Q2.2[data$Q2.2 == "২৮"] <- "27"
data$Q2.2[data$Q2.2 == "28"] <- "27"
data$Q2.2[data$Q2.2 == "29"] <- "29"
data$Q2.2[data$Q2.2 == "২৯"] <- "29"
data$Q2.2[data$Q2.2 == "30"] <- "30"
data$Q2.2[data$Q2.2 == "৩০"] <- "30"
data$Q2.2[data$Q2.2 == "৩০+"] <- "30"
data$Q2.2[data$Q2.2 == "৩১"] <- "31"
data$Q2.2[data$Q2.2 == "31"] <- "31"
data$Q2.2[data$Q2.2 == "32"] <- "32"
data$Q2.2[data$Q2.2 == "৩২"] <- "32"
data$Q2.2[data$Q2.2 == "৩৩"] <- "33"
data$Q2.2[data$Q2.2 == "33"] <- "33"
data$Q2.2[data$Q2.2 == "34"] <- "34"
data$Q2.2[data$Q2.2 == "৩৪"] <- "34"
data$Q2.2[data$Q2.2 == "৩৪ বছর"] <- "34"
data$Q2.2[data$Q2.2 == "৩৫"] <- "35"
data$Q2.2[data$Q2.2 == "35"] <- "35"
data$Q2.2[data$Q2.2 == "36"] <- "36"
data$Q2.2[data$Q2.2 == "৩৬"] <- "36"
data$Q2.2[data$Q2.2 == "37"] <- "37"
data$Q2.2[data$Q2.2 == "৩৭"] <- "37"
data$Q2.2[data$Q2.2 == "৩৭ বছর"] <- "37"
data$Q2.2[data$Q2.2 == "38"] <- "38"
data$Q2.2[data$Q2.2 == "৩৮"] <- "38"
data$Q2.2[data$Q2.2 == "39"] <- "39"
data$Q2.2[data$Q2.2 == "৩৯"] <- "39"
data$Q2.2[data$Q2.2 == "৪০"] <- "40"
data$Q2.2[data$Q2.2 == "40"] <- "40"
data$Q2.2[data$Q2.2 == "41"] <- "41"
data$Q2.2[data$Q2.2 == "৪১"] <- "41"
data$Q2.2[data$Q2.2 == "৪২"] <- "41"
data$Q2.2[data$Q2.2 == "42"] <- "42"
data$Q2.2[data$Q2.2 == "43"] <- "43"
data$Q2.2[data$Q2.2 == "৪৩"] <- "43"
data$Q2.2[data$Q2.2 == "৪৪ বছর"] <- "44"
data$Q2.2[data$Q2.2 == "৪৫"] <- "45"
data$Q2.2[data$Q2.2 == "45"] <- "45"
data$Q2.2[data$Q2.2 == "46"] <- "46"
data$Q2.2[data$Q2.2 == "৪৬"] <- "46"
data$Q2.2[data$Q2.2 == "৪৭"] <- "47"
data$Q2.2[data$Q2.2 == "৪৮"] <- "48"
data$Q2.2[data$Q2.2 == "৪৮ বছর ৪ মাস"] <- "48"
data$Q2.2[data$Q2.2 == "49"] <- "49"
data$Q2.2[data$Q2.2 == "৫০"] <- "50"
data$Q2.2[data$Q2.2 == "50"] <- "50"
data$Q2.2[data$Q2.2 == "৫০ বছর"] <- "50"
data$Q2.2[data$Q2.2 == "৫২"] <- "52"
data$Q2.2[data$Q2.2 == "৫২ বছর"] <- "52"
data$Q2.2[data$Q2.2 == "54"] <- "54"
data$Q2.2[data$Q2.2 == "৬০"] <- "60"
data$Q2.2[data$Q2.2 == "৬৩"] <- "63"
data$Q2.2[data$Q2.2 == "63"] <- "63"
data$Q2.2[data$Q2.2 == "67"] <- "67"
data$Q2.2[data$Q2.2 == "কবির"] <- "28"
data$Q2.2 <- as.numeric(data$Q2.2)

descriptives <- data %>% 
  dplyr::select(Q2.2:Q2.8_1)


Depression <- data %>% 
  dplyr::select(Q3.2:Q3.31)

GASP <- data %>% 
  dplyr::select(Q4.2:Q4.17)

BigFive <- data %>% 
  dplyr::select(Q5.2:Q5.61)


eysenck <- data %>% 
  dplyr::select(Q6.2:Q6.49)

#
#
colnames(descriptives) <- c("Age","Gender","Religion", "Marital_Status","Occupation", "Education_Years", "SES")
colnames(GASP) <- paste("GASP", 1:16,sep = "_")
colnames(Depression) <- paste("Depression", 1:30,sep = "_")
colnames(BigFive) <- paste("BF", 1:60,sep = "_")
colnames(eysenck) <- paste("EYP", 1:48,sep = "")


renamed_data <- as.data.frame(c(descriptives,GASP,Depression,BigFive))
# write_rds(renamed_data, "Processeddata/raw_data.rds" )

```

```{r data-wrangling}

# Descriptive dataframe
descriptives.names <- c("Age", "Gender", "Religion", "Marrital_Status", "Occupation", "Education", "SES")
colnames(descriptives) <- descriptives.names

## Recoding descriptives$Gender
descriptives$Gender[descriptives$Gender == "পুরুষ"] <- "Male"
descriptives$Gender[descriptives$Gender == "স্ত্রী"] <- "Female"
descriptives$Gender <- factor(descriptives$Gender)

## Recoding descriptives$Religion
descriptives$Religion <- descriptives$Religion %>%
  fct_recode(
    "Others" = "অন্যান্য",
    "Islam" = "ইসলাম",
    "Christianity" = "খ্রিস্টান",
    "Buddhism" = "বৌদ্ধ",
    "Hindu" = "সনাতন হিন্দু"
  )

## Recoding descriptives$Marrital_Status
descriptives$Marrital_Status <- descriptives$Marrital_Status %>%
  fct_recode(
    "Unmarried" = "অবিবাহিত",
    "Divorced" = "ডিভোর্সড",
    "Married" = "বিবাহিত"
  )

## Recoding descriptives$Occupation
descriptives$Occupation[descriptives$Occupation == "ছাত্র"] <- "Student"
descriptives$Occupation[descriptives$Occupation == "সরকারি চাকরিজীবী"] <- "Service Holder"
descriptives$Occupation <- factor(descriptives$Occupation)



## Recoding descriptives$Education
descriptives$Education <- descriptives$Education %>%
  fct_recode(
    "Post-Grad" = "ডক্টর অব ফিলোসফি",
    "Under-Grad" = "স্নাতক",
    "Post-Grad" = "স্নাতকোত্তর"
  )

## Reordering descriptives$Education
descriptives$Education <- descriptives$Education %>%
  fct_relevel(
    "Post-Grad", "Under-Grad"
  )

# Depression dataframe
depression.prefix <- "D"
depression.sufix <- c(1:30)
depession_names <- paste(depression.prefix,depression.sufix, sep = "" )
colnames(Depression) <-depession_names

recod_depression <- c("একেবারেই প্রযোজ্য নয়"=1,
                 "প্রযোজ্য নয়"=2,
                 "মাঝামাঝি" =3,
                 "কিছুটা প্রযোজ্য" =4,
                 "পুরোপুরি প্রযোজ্য"  = 5)

recod_depression <-  mutate(Depression, across(starts_with("D"), ~unname(recod_depression[.])))

depression <- recod_depression
depression <- depression %>% 
  mutate(total_dep= rowSums(across(starts_with("D")), na.rm = T))


# GASP dataframe
gasp.prefix <- "GASP"
gasp.sufix <- c(1:16)
gasp_names <- paste(gasp.prefix,gasp.sufix, sep = "" )
colnames(GASP) <-gasp_names

recod_gasp <- c("একদম সম্ভাবনা নেই (0%)" =1,
                "প্রায় সম্ভাবনা নেই (25%)" =2,
                 "অনিশ্চিত (50%)"   =3,
                 "প্রায় সম্ভাবনা আছে (75%)" =4,
                 "পূর্ণ সম্ভাবনা আছে (100%)"= 5,
                "পূর্ণ সম্ভাবনা আছে(100%)"=5)

recod_gasp <-  mutate(GASP, across(starts_with("GASP"), ~unname(recod_gasp[.])))

gasp <- recod_gasp

# which(is.na(gasp))

gasp <- gasp %>% 
  rowwise() %>% 
  mutate(Guilt_NBE= sum(GASP1,GASP9,GASP14,GASP16),
         GUILT_Repair = sum(GASP2,GASP5,GASP11,GASP15),
         Shame_NSE = sum(GASP3,GASP6,GASP10,GASP13),
         Shame_Withdraw = sum(GASP4,GASP7,GASP8,GASP12))



# Big Five 2 dataframe
bigfive.prefix <- "BF"
bigfive.sufix <- c(1:60)
bigfive_names <- paste(bigfive.prefix,bigfive.sufix, sep = "" )
colnames(BigFive) <-bigfive_names


recod_bigfive <- c("একেবারেই সমর্থন করি না"=1,
                 "সমর্থন করি না" =2,
                 "অনিশ্চিত"  =3,
                 "সমর্থন করি" =4,
                 "খুব বেশি  সমর্থন করি"  = 5)

recod_bigfive <-  mutate(BigFive, across(starts_with("BF"), ~unname(recod_bigfive[.])))

bigfive <- recod_bigfive






# ## Reverse coding of BigFive 2
## Recoding bigfive$BF11 into bigfive$RBF11
# bigfive$RBF11 <- as.character(bigfive$BF11)
# bigfive$RBF11[bigfive$BF11 == "1"] <- "5"
# bigfive$RBF11[bigfive$BF11 == "2"] <- "4"
# bigfive$RBF11[bigfive$BF11 == "3"] <- "3"
# bigfive$RBF11[bigfive$BF11 == "4"] <- "2"
# bigfive$RBF11[bigfive$BF11 == "5"] <- "1"
# bigfive$RBF11 <- as.numeric(bigfive$RBF11)
bigfive$RBF11 <- as.numeric(bigfive$BF11)
# bigfive$RBF11 <- bigfive$BF11

## Recoding bigfive$BF16 into bigfive$RBF16
bigfive$RBF16 <- as.character(bigfive$BF16)
bigfive$RBF16[bigfive$BF16 == "1"] <- "5"
bigfive$RBF16[bigfive$BF16 == "2"] <- "4"
bigfive$RBF16[bigfive$BF16 == "3"] <- "3"
bigfive$RBF16[bigfive$BF16 == "4"] <- "2"
bigfive$RBF16[bigfive$BF16 == "5"] <- "1"
bigfive$RBF16 <- as.numeric(bigfive$RBF16)

## Recoding bigfive$BF26 into bigfive$RBF26
bigfive$RBF26 <- as.character(bigfive$BF26)
bigfive$RBF26[bigfive$BF26 == "1"] <- "5"
bigfive$RBF26[bigfive$BF26 == "2"] <- "4"
bigfive$RBF26[bigfive$BF26 == "3"] <- "3"
bigfive$RBF26[bigfive$BF26 == "4"] <- "2"
bigfive$RBF26[bigfive$BF26 == "5"] <- "1"
bigfive$RBF26 <- as.numeric(bigfive$RBF26)

## Recoding bigfive$BF31 into bigfive$RBF31
bigfive$RBF31 <- as.character(bigfive$BF31)
bigfive$RBF31[bigfive$BF31 == "1"] <- "5"
bigfive$RBF31[bigfive$BF31 == "2"] <- "4"
bigfive$RBF31[bigfive$BF31 == "3"] <- "3"
bigfive$RBF31[bigfive$BF31 == "4"] <- "2"
bigfive$RBF31[bigfive$BF31 == "5"] <- "1"
bigfive$RBF31 <- as.numeric(bigfive$RBF31)

## Recoding bigfive$BF36 into bigfive$RBF36
bigfive$RBF36 <- as.character(bigfive$BF36)
bigfive$RBF36[bigfive$BF36 == "1"] <- "5"
bigfive$RBF36[bigfive$BF36 == "2"] <- "4"
bigfive$RBF36[bigfive$BF36 == "3"] <- "3"
bigfive$RBF36[bigfive$BF36 == "4"] <- "2"
bigfive$RBF36[bigfive$BF36 == "5"] <- "1"
bigfive$RBF36 <- as.numeric(bigfive$RBF36)

## Recoding bigfive$BF51 into bigfive$BF51_rec
bigfive$RBF51 <- as.character(bigfive$BF51)
bigfive$RBF51[bigfive$BF51 == "1"] <- "5"
bigfive$RBF51[bigfive$BF51 == "2"] <- "4"
bigfive$RBF51[bigfive$BF51 == "3"] <- "3"
bigfive$RBF51[bigfive$BF51 == "4"] <- "2"
bigfive$RBF51[bigfive$BF51 == "5"] <- "1"
bigfive$RBF51 <- as.numeric(bigfive$RBF51)

## Recoding bigfive$BF12 into bigfive$RBF12
bigfive$RBF12 <- as.character(bigfive$BF12)
bigfive$RBF12[bigfive$BF12 == "1"] <- "5"
bigfive$RBF12[bigfive$BF12 == "2"] <- "4"
bigfive$RBF12[bigfive$BF12 == "3"] <- "3"
bigfive$RBF12[bigfive$BF12 == "4"] <- "2"
bigfive$RBF12[bigfive$BF12 == "5"] <- "1"
bigfive$RBF12 <- as.numeric(bigfive$RBF12)

## Recoding bigfive$BF17 into bigfive$RBF17
bigfive$RBF17 <- as.character(bigfive$BF17)
bigfive$RBF17[bigfive$BF17 == "1"] <- "5"
bigfive$RBF17[bigfive$BF17 == "2"] <- "4"
bigfive$RBF17[bigfive$BF17 == "3"] <- "3"
bigfive$RBF17[bigfive$BF17 == "4"] <- "2"
bigfive$RBF17[bigfive$BF17 == "5"] <- "1"
bigfive$RBF17 <- as.numeric(bigfive$RBF17)

## Recoding bigfive$BF22 into bigfive$RBF22
bigfive$RBF22 <- as.character(bigfive$BF22)
bigfive$RBF22[bigfive$BF22 == "1"] <- "5"
bigfive$RBF22[bigfive$BF22 == "2"] <- "4"
bigfive$RBF22[bigfive$BF22 == "3"] <- "3"
bigfive$RBF22[bigfive$BF22 == "4"] <- "2"
bigfive$RBF22[bigfive$BF22 == "5"] <- "1"
bigfive$RBF22 <- as.numeric(bigfive$RBF22)

## Recoding bigfive$BF37 into bigfive$RBF37
bigfive$RBF37 <- as.character(bigfive$BF37)
bigfive$RBF37[bigfive$BF37 == "1"] <- "5"
bigfive$RBF37[bigfive$BF37 == "2"] <- "4"
bigfive$RBF37[bigfive$BF37 == "3"] <- "3"
bigfive$RBF37[bigfive$BF37 == "4"] <- "2"
bigfive$RBF37[bigfive$BF37 == "5"] <- "1"
bigfive$RBF37 <- as.numeric(bigfive$RBF37)

## Recoding bigfive$BF42 into bigfive$RBF42
bigfive$RBF42 <- as.character(bigfive$BF42)
bigfive$RBF42[bigfive$BF42 == "1"] <- "5"
bigfive$RBF42[bigfive$BF42 == "2"] <- "4"
bigfive$RBF42[bigfive$BF42 == "3"] <- "3"
bigfive$RBF42[bigfive$BF42 == "4"] <- "2"
bigfive$RBF42[bigfive$BF42 == "5"] <- "1"
bigfive$RBF42 <- as.numeric(bigfive$RBF42)

#### Recoding bigfive$BF47 into bigfive$RBF47
bigfive$RBF47 <- as.character(bigfive$BF47)
bigfive$RBF47[bigfive$BF47 == "1"] <- "5"
bigfive$RBF47[bigfive$BF47 == "2"] <- "4"
bigfive$RBF47[bigfive$BF47 == "3"] <- "3"
bigfive$RBF47[bigfive$BF47 == "4"] <- "2"
bigfive$RBF47[bigfive$BF47 == "5"] <- "1"
bigfive$RBF47 <- as.numeric(bigfive$RBF47)

## Recoding bigfive$BF3 into bigfive$RBF3
bigfive$RBF3 <- as.character(bigfive$BF3)
bigfive$RBF3[bigfive$BF3 == "1"] <- "5"
bigfive$RBF3[bigfive$BF3 == "2"] <- "4"
bigfive$RBF3[bigfive$BF3 == "3"] <- "3"
bigfive$RBF3[bigfive$BF3 == "4"] <- "2"
bigfive$RBF3[bigfive$BF3 == "5"] <- "1"
bigfive$RBF3 <- as.numeric(bigfive$RBF3)


## Recoding bigfive$BF8 into bigfive$RBF8
bigfive$RBF8 <- as.character(bigfive$BF8)
bigfive$RBF8[bigfive$BF8 == "1"] <- "5"
bigfive$RBF8[bigfive$BF8 == "2"] <- "4"
bigfive$RBF8[bigfive$BF8 == "3"] <- "3"
bigfive$RBF8[bigfive$BF8 == "4"] <- "2"
bigfive$RBF8[bigfive$BF8 == "5"] <- "1"
bigfive$RBF8 <- as.numeric(bigfive$RBF8)

## Recoding bigfive$BF23 into bigfive$RBF23
bigfive$RBF23 <- as.character(bigfive$BF23)
bigfive$RBF23[bigfive$BF23 == "1"] <- "5"
bigfive$RBF23[bigfive$BF23 == "2"] <- "4"
bigfive$RBF23[bigfive$BF23 == "3"] <- "3"
bigfive$RBF23[bigfive$BF23 == "4"] <- "2"
bigfive$RBF23[bigfive$BF23 == "5"] <- "1"
bigfive$RBF23 <- as.numeric(bigfive$RBF23)

## Recoding bigfive$BF28 into bigfive$RBF28
bigfive$RBF28 <- as.character(bigfive$BF28)
bigfive$RBF28[bigfive$BF28 == "1"] <- "5"
bigfive$RBF28[bigfive$BF28 == "2"] <- "4"
bigfive$RBF28[bigfive$BF28 == "3"] <- "3"
bigfive$RBF28[bigfive$BF28 == "4"] <- "2"
bigfive$RBF28[bigfive$BF28 == "5"] <- "1"
bigfive$RBF28 <- as.numeric(bigfive$RBF28)

## Recoding bigfive$BF48 into bigfive$RBF48
bigfive$RBF48 <- as.character(bigfive$BF48)
bigfive$RBF48[bigfive$BF48 == "1"] <- "5"
bigfive$RBF48[bigfive$BF48 == "2"] <- "4"
bigfive$RBF48[bigfive$BF48 == "3"] <- "3"
bigfive$RBF48[bigfive$BF48 == "4"] <- "2"
bigfive$RBF48[bigfive$BF48 == "5"] <- "1"
bigfive$RBF48 <- as.numeric(bigfive$RBF48)


## Recoding bigfive$BF58 into bigfive$RBF58
bigfive$RBF58 <- as.character(bigfive$BF58)
bigfive$RBF58[bigfive$BF58 == "1"] <- "5"
bigfive$RBF58[bigfive$BF58 == "2"] <- "4"
bigfive$RBF58[bigfive$BF58 == "3"] <- "3"
bigfive$RBF58[bigfive$BF58 == "4"] <- "2"
bigfive$RBF58[bigfive$BF58 == "5"] <- "1"
bigfive$RBF58 <- as.numeric(bigfive$RBF58)

## Recoding bigfive$BF4 into bigfive$RBF4
bigfive$RBF4 <- as.character(bigfive$BF4)
bigfive$RBF4[bigfive$BF4 == "1"] <- "5"
bigfive$RBF4[bigfive$BF4 == "2"] <- "4"
bigfive$RBF4[bigfive$BF4 == "3"] <- "3"
bigfive$RBF4[bigfive$BF4 == "4"] <- "2"
bigfive$RBF4[bigfive$BF4 == "5"] <- "1"
bigfive$RBF4 <- as.numeric(bigfive$RBF4)

## Recoding bigfive$BF9 into bigfive$RBF9
bigfive$RBF9 <- as.character(bigfive$BF9)
bigfive$RBF9[bigfive$BF9 == "1"] <- "5"
bigfive$RBF9[bigfive$BF9 == "2"] <- "4"
bigfive$RBF9[bigfive$BF9 == "3"] <- "3"
bigfive$RBF9[bigfive$BF9 == "4"] <- "2"
bigfive$RBF9[bigfive$BF9 == "5"] <- "1"
bigfive$RBF9 <- as.numeric(bigfive$RBF9)

## Recoding bigfive$BF24 into bigfive$RBF24
bigfive$RBF24 <- as.character(bigfive$BF24)
bigfive$RBF24[bigfive$BF24 == "1"] <- "5"
bigfive$RBF24[bigfive$BF24 == "2"] <- "4"
bigfive$RBF24[bigfive$BF24 == "3"] <- "3"
bigfive$RBF24[bigfive$BF24 == "4"] <- "2"
bigfive$RBF24[bigfive$BF24 == "5"] <- "1"
bigfive$RBF24 <- as.numeric(bigfive$RBF24)

## Recoding bigfive$BF29 into bigfive$RBF29
bigfive$RBF29 <- as.character(bigfive$BF29)
bigfive$RBF29[bigfive$BF29 == "1"] <- "5"
bigfive$RBF29[bigfive$BF29 == "2"] <- "4"
bigfive$RBF29[bigfive$BF29 == "3"] <- "3"
bigfive$RBF29[bigfive$BF29 == "4"] <- "2"
bigfive$RBF29[bigfive$BF29 == "5"] <- "1"
bigfive$RBF29 <- as.numeric(bigfive$RBF29)

## Recoding bigfive$BF44 into bigfive$RBF44
bigfive$RBF44 <- as.character(bigfive$BF44)
bigfive$RBF44[bigfive$BF44 == "1"] <- "5"
bigfive$RBF44[bigfive$BF44 == "2"] <- "4"
bigfive$RBF44[bigfive$BF44 == "3"] <- "3"
bigfive$RBF44[bigfive$BF44 == "4"] <- "2"
bigfive$RBF44[bigfive$BF44 == "5"] <- "1"
bigfive$RBF44 <- as.numeric(bigfive$RBF44)

## Recoding bigfive$BF49 into bigfive$RBF49
bigfive$RBF49 <- as.character(bigfive$BF49)
bigfive$RBF49[bigfive$BF49 == "1"] <- "5"
bigfive$RBF49[bigfive$BF49 == "2"] <- "4"
bigfive$RBF49[bigfive$BF49 == "3"] <- "3"
bigfive$RBF49[bigfive$BF49 == "4"] <- "2"
bigfive$RBF49[bigfive$BF49 == "5"] <- "1"
bigfive$RBF49 <- as.numeric(bigfive$RBF49)

## Recoding bigfive$BF5 into bigfive$RBF5
bigfive$RBF5 <- as.character(bigfive$BF5)
bigfive$RBF5[bigfive$BF5 == "1"] <- "5"
bigfive$RBF5[bigfive$BF5 == "2"] <- "4"
bigfive$RBF5[bigfive$BF5 == "3"] <- "3"
bigfive$RBF5[bigfive$BF5 == "4"] <- "2"
bigfive$RBF5[bigfive$BF5 == "5"] <- "1"
bigfive$RBF5 <- as.numeric(bigfive$RBF5)



## Recoding bigfive$BF25 into bigfive$RBF25
bigfive$RBF25 <- as.character(bigfive$BF25)
bigfive$RBF25[bigfive$BF25 == "1"] <- "5"
bigfive$RBF25[bigfive$BF25 == "2"] <- "4"
bigfive$RBF25[bigfive$BF25 == "3"] <- "3"
bigfive$RBF25[bigfive$BF25 == "4"] <- "2"
bigfive$RBF25[bigfive$BF25 == "5"] <- "1"
bigfive$RBF25 <- as.numeric(bigfive$RBF25)

## Recoding bigfive$BF30 into bigfive$RBF30
bigfive$RBF30 <- as.character(bigfive$BF30)
bigfive$RBF30[bigfive$BF30 == "1"] <- "5"
bigfive$RBF30[bigfive$BF30 == "2"] <- "4"
bigfive$RBF30[bigfive$BF30 == "3"] <- "3"
bigfive$RBF30[bigfive$BF30 == "4"] <- "2"
bigfive$RBF30[bigfive$BF30 == "5"] <- "1"
bigfive$RBF30 <- as.numeric(bigfive$RBF30)

## Recoding bigfive$BF45 into bigfive$RBF45
bigfive$RBF45 <- as.character(bigfive$BF45)
bigfive$RBF45[bigfive$BF45 == "1"] <- "5"
bigfive$RBF45[bigfive$BF45 == "2"] <- "4"
bigfive$RBF45[bigfive$BF45 == "3"] <- "3"
bigfive$RBF45[bigfive$BF45 == "4"] <- "2"
bigfive$RBF45[bigfive$BF45 == "5"] <- "1"
bigfive$RBF45 <- as.numeric(bigfive$RBF45)


## Recoding bigfive$BF50 into bigfive$RBF50
bigfive$RBF50 <- as.character(bigfive$BF50)
bigfive$RBF50[bigfive$BF50 == "1"] <- "5"
bigfive$RBF50[bigfive$BF50 == "2"] <- "4"
bigfive$RBF50[bigfive$BF50 == "3"] <- "3"
bigfive$RBF50[bigfive$BF50 == "4"] <- "2"
bigfive$RBF50[bigfive$BF50 == "5"] <- "1"
bigfive$RBF50 <- as.numeric(bigfive$RBF50)


## Recoding bigfive$BF55 into bigfive$RBF55
bigfive$RBF55 <- as.character(bigfive$BF55)
bigfive$RBF55[bigfive$BF55 == "1"] <- "5"
bigfive$RBF55[bigfive$BF55 == "2"] <- "4"
bigfive$RBF55[bigfive$BF55 == "3"] <- "3"
bigfive$RBF55[bigfive$BF55 == "4"] <- "2"
bigfive$RBF55[bigfive$BF55 == "5"] <- "1"
bigfive$RBF55 <- as.numeric(bigfive$RBF55)



## Recoding bigfive$BF56
bigfive$BF56 <- as.character(bigfive$BF56)
bigfive$BF56[bigfive$BF56 == "1"] <- "1"
bigfive$BF56[bigfive$BF56 == "2"] <- "2"
bigfive$BF56[bigfive$BF56 == "3"] <- "3"
bigfive$BF56[bigfive$BF56 == "4"] <- "4"
bigfive$BF56[bigfive$BF56 == "5"] <- "5"
bigfive$BF56 <- factor(bigfive$BF56)



bigfive <- as.data.frame(lapply(bigfive, as.numeric))

#Eysenck



## Recoding eysenck$EYP10
eysenck$EYP10[eysenck$EYP10 == "না"] <- "0"
eysenck$EYP10[eysenck$EYP10 == "হ্যাঁ"] <- "1"
eysenck$EYP10 <- as.numeric(eysenck$EYP10)

## Recoding eysenck$EYP14
eysenck$EYP14[eysenck$EYP14 == "না"] <- "0"
eysenck$EYP14[eysenck$EYP14 == "হ্যাঁ"] <- "1"
eysenck$EYP14 <- as.numeric(eysenck$EYP14)


## Recoding eysenck$EYP22
eysenck$EYP22[eysenck$EYP22 == "না"] <- "0"
eysenck$EYP22[eysenck$EYP22 == "হ্যাঁ"] <- "1"
eysenck$EYP22 <- as.numeric(eysenck$EYP22)

## Recoding eysenck$EYP31
eysenck$EYP31[eysenck$EYP31 == "না"] <- "0"
eysenck$EYP31[eysenck$EYP31 == "হ্যাঁ"] <- "1"
eysenck$EYP31 <- as.numeric(eysenck$EYP31)


## Recoding eysenck$EYP39
eysenck$EYP39[eysenck$EYP39 == "না"] <- "0"
eysenck$EYP39[eysenck$EYP39 == "হ্যাঁ"] <- "1"
eysenck$EYP39 <- as.numeric(eysenck$EYP39)



## Recoding eysenck$EYP3
eysenck$EYP3[eysenck$EYP3 == "না"] <- "0"
eysenck$EYP3[eysenck$EYP3 == "হ্যাঁ"] <- "1"
eysenck$EYP3 <- as.numeric(eysenck$EYP3)

## Recoding eysenck$EYP7
eysenck$EYP7[eysenck$EYP7 == "না"] <- "0"
eysenck$EYP7[eysenck$EYP7 == "হ্যাঁ"] <- "1"
eysenck$EYP7 <- as.numeric(eysenck$EYP7)

## Recoding eysenck$EYP11
eysenck$EYP11[eysenck$EYP11 == "না"] <- "0"
eysenck$EYP11[eysenck$EYP11 == "হ্যাঁ"] <- "1"
eysenck$EYP11 <- as.numeric(eysenck$EYP11)

## Recoding eysenck$EYP15
eysenck$EYP15[eysenck$EYP15 == "না"] <- "0"
eysenck$EYP15[eysenck$EYP15 == "হ্যাঁ"] <- "1"
eysenck$EYP15 <- as.numeric(eysenck$EYP15)

## Recoding eysenck$EYP19
eysenck$EYP19[eysenck$EYP19 == "না"] <- "0"
eysenck$EYP19[eysenck$EYP19 == "হ্যাঁ"] <- "1"
eysenck$EYP19 <- as.numeric(eysenck$EYP19)


## Recoding eysenck$EYP23
eysenck$EYP23[eysenck$EYP23 == "না"] <- "0"
eysenck$EYP23[eysenck$EYP23 == "হ্যাঁ"] <- "1"
eysenck$EYP23 <- as.numeric(eysenck$EYP23)


## Recoding eysenck$EYP32
eysenck$EYP32[eysenck$EYP32 == "না"] <- "0"
eysenck$EYP32[eysenck$EYP32 == "হ্যাঁ"] <- "1"
eysenck$EYP32 <- as.numeric(eysenck$EYP32)


## Recoding eysenck$EYP36
eysenck$EYP36[eysenck$EYP36 == "না"] <- "0"
eysenck$EYP36[eysenck$EYP36 == "হ্যাঁ"] <- "1"
eysenck$EYP36 <- as.numeric(eysenck$EYP36)

## Recoding eysenck$EYP44
eysenck$EYP44[eysenck$EYP44 == "না"] <- "0"
eysenck$EYP44[eysenck$EYP44 == "হ্যাঁ"] <- "1"
eysenck$EYP44 <- as.numeric(eysenck$EYP44)


## Recoding eysenck$EYP48
eysenck$EYP48[eysenck$EYP48 == "না"] <- "0"
eysenck$EYP48[eysenck$EYP48 == "হ্যাঁ"] <- "1"
eysenck$EYP48 <- as.numeric(eysenck$EYP48)


## Recoding eysenck$EYP4
eysenck$EYP1[eysenck$EYP1 == "না"] <- "0"
eysenck$EYP1[eysenck$EYP1 == "হ্যাঁ"] <- "1"
eysenck$EYP1 <- as.numeric(eysenck$EYP1)


## Recoding eysenck$EYP5
eysenck$EYP5[eysenck$EYP5 == "না"] <- "0"
eysenck$EYP5[eysenck$EYP5 == "হ্যাঁ"] <- "1"
eysenck$EYP5 <- as.numeric(eysenck$EYP5)

## Recoding eysenck$EYP9
eysenck$EYP9[eysenck$EYP9 == "না"] <- "0"
eysenck$EYP9[eysenck$EYP9 == "হ্যাঁ"] <- "1"
eysenck$EYP9 <- as.numeric(eysenck$EYP9)


## Recoding eysenck$EYP13
eysenck$EYP13[eysenck$EYP13 == "না"] <- "0"
eysenck$EYP13[eysenck$EYP13 == "হ্যাঁ"] <- "1"
eysenck$EYP13 <- as.numeric(eysenck$EYP13)


## Recoding eysenck$EYP17
eysenck$EYP17[eysenck$EYP17 == "না"] <- "0"
eysenck$EYP17[eysenck$EYP17 == "হ্যাঁ"] <- "1"
eysenck$EYP17 <- as.numeric(eysenck$EYP17)


## Recoding eysenck$EYP21
eysenck$EYP21[eysenck$EYP21 == "না"] <- "0"
eysenck$EYP21[eysenck$EYP21 == "হ্যাঁ"] <- "1"
eysenck$EYP21 <- as.numeric(eysenck$EYP21)




## Recoding eysenck$EYP25
eysenck$EYP25[eysenck$EYP25 == "না"] <- "0"
eysenck$EYP25[eysenck$EYP25 == "হ্যাঁ"] <- "1"
eysenck$EYP25 <- as.numeric(eysenck$EYP25)


## Recoding eysenck$EYP30
eysenck$EYP30[eysenck$EYP30 == "না"] <- "0"
eysenck$EYP30[eysenck$EYP30 == "হ্যাঁ"] <- "1"
eysenck$EYP30 <- as.numeric(eysenck$EYP30)



## Recoding eysenck$EYP34
eysenck$EYP34[eysenck$EYP34 == "না"] <- "0"
eysenck$EYP34[eysenck$EYP34 == "হ্যাঁ"] <- "1"
eysenck$EYP34 <- as.numeric(eysenck$EYP34)



## Recoding eysenck$EYP38
eysenck$EYP38[eysenck$EYP38 == "না"] <- "0"
eysenck$EYP38[eysenck$EYP38 == "হ্যাঁ"] <- "1"
eysenck$EYP38 <- as.numeric(eysenck$EYP38)



## Recoding eysenck$EYP42
eysenck$EYP42[eysenck$EYP42 == "না"] <- "0"
eysenck$EYP42[eysenck$EYP42 == "হ্যাঁ"] <- "1"
eysenck$EYP42 <- as.numeric(eysenck$EYP42)


## Recoding eysenck$EYP46
eysenck$EYP46[eysenck$EYP46 == "না"] <- "0"
eysenck$EYP46[eysenck$EYP46 == "হ্যাঁ"] <- "1"
eysenck$EYP46 <- as.numeric(eysenck$EYP46)



## Recoding eysenck$EYP42
eysenck$EYP42[eysenck$EYP42 == "না"] <- "0"
eysenck$EYP42[eysenck$EYP42 == "হ্যাঁ"] <- "1"
eysenck$EYP42 <- as.numeric(eysenck$EYP42)

## Recoding eysenck$EYP4
eysenck$EYP4[eysenck$EYP4 == "না"] <- "0"
eysenck$EYP4[eysenck$EYP4 == "হ্যাঁ"] <- "1"
eysenck$EYP4 <- as.numeric(eysenck$EYP4)


## Recoding eysenck$EYP16
eysenck$EYP16[eysenck$EYP16 == "না"] <- "0"
eysenck$EYP16[eysenck$EYP16 == "হ্যাঁ"] <- "1"
eysenck$EYP16 <- as.numeric(eysenck$EYP16)


## Recoding eysenck$EYP45
eysenck$EYP45[eysenck$EYP45 == "না"] <- "0"
eysenck$EYP45[eysenck$EYP45 == "হ্যাঁ"] <- "1"
eysenck$EYP45 <- as.numeric(eysenck$EYP45)


## Recoding eysenck$EYP2
eysenck$EYP2[eysenck$EYP2 == "না"] <- "1"
eysenck$EYP2[eysenck$EYP2 == "হ্যাঁ"] <- "0"
eysenck$EYP2 <- as.numeric(eysenck$EYP2)


## Recoding eysenck$EYP6
eysenck$EYP6[eysenck$EYP6 == "না"] <- "1"
eysenck$EYP6[eysenck$EYP6 == "হ্যাঁ"] <- "0"
eysenck$EYP6 <- as.numeric(eysenck$EYP6)


## Recoding eysenck$EYP18
eysenck$EYP18[eysenck$EYP18 == "না"] <- "1"
eysenck$EYP18[eysenck$EYP18 == "হ্যাঁ"] <- "0"
eysenck$EYP18 <- as.numeric(eysenck$EYP18)


## Recoding eysenck$EYP26
eysenck$EYP26[eysenck$EYP26 == "না"] <- "1"
eysenck$EYP26[eysenck$EYP26 == "হ্যাঁ"] <- "0"
eysenck$EYP26 <- as.numeric(eysenck$EYP26)


## Recoding eysenck$EYP28
eysenck$EYP28[eysenck$EYP28 == "না"] <- "1"
eysenck$EYP28[eysenck$EYP28 == "হ্যাঁ"] <- "0"
eysenck$EYP28 <- as.numeric(eysenck$EYP28)

## Recoding eysenck$EYP35
eysenck$EYP35[eysenck$EYP35 == "না"] <- "1"
eysenck$EYP35[eysenck$EYP35 == "হ্যাঁ"] <- "0"
eysenck$EYP35 <- as.numeric(eysenck$EYP35)


## Recoding eysenck$EYP43
eysenck$EYP43[eysenck$EYP43 == "না"] <- "1"
eysenck$EYP43[eysenck$EYP43 == "হ্যাঁ"] <- "0"
eysenck$EYP43 <- as.numeric(eysenck$EYP43)


## Recoding eysenck$EYP27
eysenck$EYP27[eysenck$EYP27 == "না"] <- "1"
eysenck$EYP27[eysenck$EYP27 == "হ্যাঁ"] <- "0"
eysenck$EYP27 <- as.numeric(eysenck$EYP27)

## Recoding eysenck$EYP41
eysenck$EYP41[eysenck$EYP41 == "না"] <- "1"
eysenck$EYP41[eysenck$EYP41 == "হ্যাঁ"] <- "0"
eysenck$EYP41 <- as.numeric(eysenck$EYP41)


## Recoding eysenck$EYP8
eysenck$EYP8[eysenck$EYP8 == "না"] <- "1"
eysenck$EYP8[eysenck$EYP8 == "হ্যাঁ"] <- "0"
eysenck$EYP8 <- as.numeric(eysenck$EYP8)

## Recoding eysenck$EYP12
eysenck$EYP12[eysenck$EYP12 == "না"] <- "1"
eysenck$EYP12[eysenck$EYP12 == "হ্যাঁ"] <- "0"
eysenck$EYP12 <- as.numeric(eysenck$EYP12)

## Recoding eysenck$EYP20
eysenck$EYP20[eysenck$EYP20 == "না"] <- "1"
eysenck$EYP20[eysenck$EYP20 == "হ্যাঁ"] <- "0"
eysenck$EYP20 <- as.numeric(eysenck$EYP20)

## Recoding eysenck$EYP24
eysenck$EYP24[eysenck$EYP24 == "না"] <- "1"
eysenck$EYP24[eysenck$EYP24 == "হ্যাঁ"] <- "0"
eysenck$EYP24 <- as.numeric(eysenck$EYP24)

## Recoding eysenck$EYP29
eysenck$EYP29[eysenck$EYP29 == "না"] <- "1"
eysenck$EYP29[eysenck$EYP29 == "হ্যাঁ"] <- "0"
eysenck$EYP29 <- as.numeric(eysenck$EYP29)

## Recoding eysenck$EYP33
eysenck$EYP33[eysenck$EYP33 == "না"] <- "1"
eysenck$EYP33[eysenck$EYP33 == "হ্যাঁ"] <- "0"
eysenck$EYP33 <- as.numeric(eysenck$EYP33)

## Recoding eysenck$EYP37
eysenck$EYP37[eysenck$EYP37 == "না"] <- "1"
eysenck$EYP37[eysenck$EYP37 == "হ্যাঁ"] <- "0"
eysenck$EYP37 <- as.numeric(eysenck$EYP37)

## Recoding eysenck$EYP40
eysenck$EYP40[eysenck$EYP40 == "না"] <- "1"
eysenck$EYP40[eysenck$EYP40 == "হ্যাঁ"] <- "0"
eysenck$EYP40 <- as.numeric(eysenck$EYP40)


## Recoding eysenck$EYP47
eysenck$EYP47[eysenck$EYP47 == "না"] <- "1"
eysenck$EYP47[eysenck$EYP47 == "হ্যাঁ"] <- "0"
eysenck$EYP47 <- as.numeric(eysenck$EYP47)

```

# Methods

## Participants

```{r demographics, include=FALSE}
descriptives$Age <- as.numeric(descriptives$Age)
descriptives$SES <- as.numeric(descriptives$SES)

# create descriptive table for the demographic vars  with gtsummary
desc_table <- descriptives%>%
  tbl_summary(
    by = Gender,
    type = list(Age ~ 'continuous',
                SES~'continuous'),
    statistic = list(all_continuous() ~ "{mean} ({sd})", 
                     all_categorical() ~ "{n} ({p}%)"),
    
    digits = all_continuous() ~ 2,
    label = list(Age ~ "Age",
                 SES ~ "Socio-economic Status",
                 Marrital_Status~ "Marrital Status"),
    missing = "no",
    sort = all_categorical() ~ "frequency",
    ) %>% add_overall() %>% bold_labels() %>% 
modify_header(label ~ "**Variable**") %>% 
  modify_caption("Demographic Characteristics (n=649)")  

as_tibble(desc_table) -> desc_tibble 
as_kable_extra(desc_table, format = "latex",booktabs = T) -> desc_kable #save it as a knitr::kable
des_gt_Gender_hux <- as_hux_table(desc_table)


des <- descriptives %>% 
  psych::describeBy("Gender")
female <- as.tibble(des$Female)
male <- as.tibble(des$Male)

```


```{r description-tab,  results='asis'}
papaja::apa_table(des_gt_Gender_hux)
```


A large scale online survey was conducted to collect data from Bangladeshi adults (n=700). Any Bangladeshi citizen aged >18 years and were able to read and write Bangla language was eligible to participate in the survey. The completion rate of our survey was 93% (50 participants' data was excluded due to incompleteness). Out of `r nrow(data)` participants, `r female[1,2]` were female ranging in age from `r female[1,8]` to `r female[1,9]` years (`r round(female[1,3],2)`±`r round(female[1,4],2)`). `r male[1,2]`  were male with an age range between `r male[1,8]` to `r male[1,9]` years (`r round(male[1,3],2)`±`r round(male[1,4],2)`). Majority of the participants had at least a Bachelor Degree (`r desc_tibble[16,2]`) and were married (`r desc_tibble[9,2]`). The mean score of perceived social stance measured by a 10-point ladder was `r round(female[7,3],2)`±`r round(female[7,4],2)` for female, and `r round(male[7,3],2)`±`r round(male[7,4],2)` for male. 

## Material

## BIG Five 2

## Bangla Big Five 2

## EYP

## Procedure

## Data analyses

We used R with several statistical packages including esemComp, lavaan and tabledown to analyze our data. First, we explored the descriptive statistics and estimated the reliability of each domain and facet of Big five 2 inventories. Second, we investigated domain level structural validity of BF2 inventories by conventional confirmatory factor analysis (CFA) as well as Exploratory Structural Analysis Modeling (ESEM)- a substantive-methodological synergy that integrates the computational power of confirmatory factor analysis and exploratory factor analysis. At domain level latent structure we examined whether BF2 factors could be recovered in our sample using item-level (each item serve as an indicator of the Big Five domain). In ESEM we allowed all items to load on all five domain factors using a rotated target matrix (60 x 5) where the primary loading's positions were left unspecified and the cross-loadings were set to zero. In CFA analysis we used "Weighted Least Square with mean and variance" (WSMV) estimator. To assess the model fit we followed the popular suggestions of @RN1162: Comparative fit index (CFI) and the Tucker Lewis index (TLI): good fit $\geq$.95, acceptable fit$\geq$.90); the root mean square error of approximation (RMSEA): good fit < .06, acceptable fit <.08; and the standardized root mean square (SRMR) good fit<.08, acceptable fit <.10.

Third, we investigated the facet level structural validity of each domain using CFA with an aim to confirm the three-facet structure of each domain. Here, we have tested the five models soto and jon used in their study to investigate the facet level structure of BF2:
(M1) Single Domain Structure- all 12 items of a domain was allowed to load on a single factor; (M2) Single Domain with acquiescence- in addition to the single domain factor an acquiescence method factor was added. In line with with their, study, we forced  constrained the factor loadings of all items on the acquiescence factor to be equal to 1 making both true-keyed and false-keyed items to load in the same direction. To ensure the proper representation of individual differences that is caused by response pattern style but not due to personality content, the acquiescence factor were not allowed to correlated with domain factors; (M3) positive and negative items-two correlataed factors where true keyed items were loaded on one factor and false-keyed were loaded on another; (M4) the three facets model- represents the three facets within each Big Five Domain; (M5) three facets plus acquiescence model- An acquiescence factor was added to the the three facets model. In this model each item was allowed to load on its corresponding facet as well as on acquiescence method factor. All factor loadings in the acquiescence factor were constrained to equal 1 and no correlation was allowed between the acquiescence factor and the three facets. To assess the model fit we followed the aforementioned guideline.

Fourth, we extended the ESEM based domain level model to investigates the full measurement invariance using Marsh et al (2009) proposed 13 model taxonomy. This allowed us compare the invariance at the item level using raw data, thus accounting for individual item functioning. This 13-model taxonomy integrates factorial and measurement invariance techniques (ref from a new look at the big five). Typically measurement invariance investigation incorporates a sequence of model fit testing  starting with least restricted model-configural invariance with no parameter invariance constrain. Weak measurement invariance model constraints factor loading across the groups. Strong measurement invariance assumes the indicator means and factor loadings to be invariance over groups. Strict Measurement invariance constrain the factor loadings, indicator means, and item uniquenesses to be equal over the groups. Marsh et al (2009) proposed 13 model taxonomy expand these four model based invariance testing where the sequence of testing propagates  from configural invariance to a model of full invariance that posits strict invariance and the invariance of latent mean and factor variance– covariance matrix. To compare BF2 scale's score across different groups at least strict measurement invariance is required (see Table 1; for a more extended discussion of these issues, see also Marsh et al., 2009)
.

Fifth, we developed two abridged versions of Bangla Big five 2: 15-item BBFI-2-XS and 30 item-BBFI2-S. To accurately represent the content and structure of the full BFI-2, we fiited "graded response" based IRT models with for each facet using "mirt" package [@R-mirt] and selected items with the highest discrimination index from each facet. For the 30 item-BBFI-2-S we supplemented the 15-item BBFI2-XS with one additional item from each facets. To select the second item we used the following criteria: (a) the discrimination index of the items; (c) And, ensuring that the BBFI-2-S included one true-keyed item and one false-keyed item for each facet. In IRT we employed marginal maximum likelihood estimation method with MHRM algorithm. We gathered information on item difficulty, discrimination, item information and test information. We assessed the local fit of the items using S-$\chi^2$ and RMSEA statistics. Person-fit was assessed using $Z_h$ statistics. 

Lastly, we investigated the concurrent validity of the domains and facets of Big-Five-2 (60 items, 30 items and 15 items) with GASP depression and EYP


# Results

```{r reliability, include=F}

bigfive_reliability <- as.data.frame(lapply(bigfive, as.numeric))

extroversion_rel_data <- bigfive_reliability %>% dplyr::select(BF1, RBF16, BF46,RBF31,BF21,RBF36 ,RBF51,BF6,BF41, BF56,RBF26,BF11)

agreebleness_rel_data <-   bigfive_reliability %>% dplyr::select(BF2,RBF17,BF32,RBF47, BF7,RBF22,RBF37,BF52, RBF12,BF27,RBF42,BF57)

conscientiousness_rel_data<-   bigfive_reliability %>% dplyr::select(RBF3 , BF18 ,BF33 ,RBF48, RBF8 , RBF23, BF38 ,BF53, BF13,RBF28,BF43,RBF58)

negative_emotionality_rel_data<-   bigfive_reliability %>% dplyr::select(RBF4 ,BF19 ,BF34 ,RBF49,RBF9,RBF24,BF39,BF54,BF14 ,RBF29 ,RBF44,BF59 )

open_mind_rel_data <-   bigfive_reliability %>% dplyr::select(BF10,RBF25,BF40,RBF55, RBF5,BF20,BF35 , RBF50,BF15 ,RBF30 , RBF45  ,BF60)

extroversion_alpha <- coefficientalpha::alpha(extroversion_rel_data)

agreebleness_alpha <- coefficientalpha::alpha(agreebleness_rel_data)

conscientiousness_alpha <- coefficientalpha::alpha(conscientiousness_rel_data)

negative_emotionality_alpha <- coefficientalpha::alpha(negative_emotionality_rel_data)

open_mind_alpha_ordinal <- coefficientalpha::alpha(open_mind_rel_data)

library(psych)

extroversion_alpha_ordinal <- psych::alpha(polychoric(extroversion_rel_data)$rho)

agreebleness_alpha_ordinal <- psych::alpha(polychoric(agreebleness_rel_data)$rho)

conscientiousness_alpha_ordinal <- psych::alpha(polychoric(conscientiousness_rel_data)$rho)

negative_emotionality_alpha_ordinal <- psych::alpha(polychoric(negative_emotionality_rel_data)$rho)

open_mind_alpha_ordinal <- psych::alpha(polychoric(open_mind_rel_data)$rho)



extroversion_omega <- coefficientalpha::omega(extroversion_rel_data)

agreebleness_omega <- coefficientalpha::omega(agreebleness_rel_data)

conscientiousness_omega <- coefficientalpha::omega(conscientiousness_rel_data)

negative_emotionality_omega <- coefficientalpha::omega(negative_emotionality_rel_data)

open_mind_alpha_omega <- coefficientalpha::omega(open_mind_rel_data)


```

```{r esem-domain, eval=FALSE, include=FALSE}
# devtools::install_github("MateusPsi/esemComp")
library(esemComp)
esem_data <- bigfive %>% 
  dplyr::select(BF1, BF6, RBF11,RBF16, BF21, RBF26, RBF31, RBF36, BF41 ,BF46 , RBF51 , BF56,
                
        BF2 , BF7 , RBF12 ,RBF17 , RBF22 , BF27 , BF32 , RBF37 , RBF42 ,  RBF47 , BF52 ,BF57, 
        RBF3 , RBF8 , BF13 , BF18 , RBF23 , RBF28 , BF33 , BF38 , BF43  , RBF48 ,BF53 ,RBF58,
        
        RBF4 , RBF9 , BF14 , BF19 , RBF24 , RBF29 , BF34 , BF39 ,RBF44 ,RBF49 ,BF54 , BF59,
         
        RBF5 , BF10 ,BF15 ,BF20 , RBF25 ,RBF30 , BF35 ,BF40 , RBF45 , RBF50 ,RBF55 ,BF60)


esem_data_2 <- as.data.frame(lapply(esem_data, as.numeric))
#Rename variables
# names(esem_data) <- paste0("x", c(1:29))

#creating a target matrix
target_rot <- esemComp::make_target(60,#Item number
                                    mainloadings=list(
                                      Extrovert=1:12,
                                      Agree=13:24,
                                       Concen=25:36,
                                        NE=37:48,
                                       OM=49:60))


esem_tareget_efa <- esem_efa(esem_data_2,nfactors=5, target= target_rot, fm="ml")

#Find the referent item for each factor
referents <- find_referents(esem_tareget_efa, factor_names = c("NE", "Concen", "Agree","OM", "Extrovert"))

#make esem model
esem_model <- syntax_composer(esem_tareget_efa, referents)

#print model
# writeLines(esem_model)


#Fit the model
esem_fit <- lavaan::cfa(esem_model, esem_data_2,ordered = names(esem_data_2), estimator = "WLSMV", mimic = "Mplus", std.lv=T)

esem_sumary <- summary(esem_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)


fitmeasures (esem_fit ,c("gfi", "agfi", "nfi","rfi", "cfi.scaled","tli.scaled","rmsea.scaled", "srmr","aic"))

# rel.esm <- reliability(esem_fit, return.total = TRUE)
# 
# rel.esm.m <- rel.esm[4,]


library("semTools")

# saveFile(esem_fit, "Figures/esem_domain.txt","coef", tableFormat = T)
```

```{r esem-domain-invariance-gender, eval=FALSE, include=FALSE}
# model 1 none configural
# model 2 loadings weak 
# model 3 loadings residuals
# model 4 loading factor cov
# model 5 loading intercepts strong
# model 6 loadings residuals factor cov
# model 7 loading residuals intercepts  strict
# model 8 loading factor cov intercepts
# model 9 =Loadings, Residuals, Factor V/Cov, Intercepts
# 
# model 10= Loadings, Intercepts, Factor Means
# 
# model 11= Loadings, Residuals, Intercepts, Factor Means
# 
# model 12=Loadings, Factor V/Cov, Intercepts, Factor Means  
# 
# model 13= Loadings, Residuals, Factor V/Cov, Intercepts, Factor Means  



#Masrh  13 Model Taxonomy

invariance_data <- cbind(descriptives$Gender,descriptives$Occupation, esem_data_2)

colnames(invariance_data)[1] <- "Gender" 
colnames(invariance_data)[2] <- "Occupation" 

invariance_data_model <- esem_model


#Model 1
invariance_model_1 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV")


invariance_model_1_summary <- summary(invariance_model_1, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_1 <- readRDS("Processeddata/Invariance_data/invariance_model_1_gender.rds")
invariance_model_1_fitindices <- fitmeasures (invariance_model_1,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled", "rmsea",
                        "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_1, "Processeddata/Invariance_data/invariance_model_1_gender.rds")

#Model 2: Weak/metric

invariance_model_2 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = "loadings")


invariance_model_2_summary <- summary(invariance_model_2, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_2 <- readRDS("Processeddata/Invariance_data/invariance_model_2_gender.rds")

invariance_model_2_fitindices <- fitmeasures (invariance_model_2,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled", "rmsea",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_2, "Processeddata/Invariance_data/invariance_model_2_gender.rds")



#Model 3

invariance_model_3 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings","residuals"))

invariance_model_3_summary <- summary(invariance_model_3, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_3 <- readRDS("Processeddata/Invariance_data/invariance_model_3_gender.rds")

invariance_model_3_fitindices <- fitmeasures (invariance_model_3,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))
            

write_rds(invariance_model_3, "Processeddata/Invariance_data/invariance_model_3_gender.rds")



#Model 4

invariance_model_4 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings","lv.variances","lv.covariances"))

invariance_model_4_summary <- summary(invariance_model_4, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_4 <- readRDS("Processeddata/Invariance_data/invariance_model_4_gender.rds")

invariance_model_4_fitindices <- fitmeasures (invariance_model_4,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_4, "Processeddata/Invariance_data/invariance_model_4_gender.rds")


#Model 5: Strong/Scaler

invariance_model_5 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts"))

invariance_model_5_summary <- summary(invariance_model_5, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_5 <- readRDS("Processeddata/Invariance_data/invariance_model_5_gender.rds")

invariance_model_5_fitindices <- fitmeasures (invariance_model_5,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_5, "Processeddata/Invariance_data/invariance_model_5_gender.rds")


#Model 6

invariance_model_6 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "lv.variances","lv.covariances","residuals"))

invariance_model_6_summary <- summary(invariance_model_6, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_6 <- readRDS("Processeddata/Invariance_data/invariance_model_6_gender.rds")

invariance_model_6_fitindices <- fitmeasures (invariance_model_6,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_6, "Processeddata/Invariance_data/invariance_model_6_gender.rds")



#Model 7: Strict/residual

invariance_model_7 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "residuals"))

invariance_model_7_summary <- summary(invariance_model_7, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)


# invariance_model_7 <- readRDS("Processeddata/Invariance_data/invariance_model_7_gender.rds")

invariance_model_7_fitindices <- fitmeasures (invariance_model_7,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_7, "Processeddata/Invariance_data/invariance_model_7_gender.rds")


#Model 8

invariance_model_8 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "lv.variances","lv.covariances"))

invariance_model_8_summary <- summary(invariance_model_8, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_8 <- readRDS("Processeddata/Invariance_data/invariance_model_8_gender.rds")


invariance_model_8_fitindices <- fitmeasures (invariance_model_8,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_8, "Processeddata/Invariance_data/invariance_model_8_gender.rds")

#Model 9

invariance_model_9 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "lv.variances","lv.covariances","residuals"))

invariance_model_9_summary <- summary(invariance_model_9, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_9 <- readRDS("Processeddata/Invariance_data/invariance_model_9_gender.rds")

invariance_model_9_fitindices <- fitmeasures (invariance_model_9,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_9, "Processeddata/Invariance_data/invariance_model_9_gender.rds")


#Model 10

invariance_model_10 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "means"))

invariance_model_10_summary <- summary(invariance_model_10, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_10 <- readRDS("Processeddata/Invariance_data/invariance_model_10_gender.rds")

invariance_model_10_fitindices <- fitmeasures (invariance_model_10,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_10, "Processeddata/Invariance_data/invariance_model_10_gender.rds")


#Model 11

invariance_model_11 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "residuals","intercepts", "means"))

invariance_model_11_summary <- summary(invariance_model_11, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_11 <- readRDS("Processeddata/Invariance_data/invariance_model_11_gender.rds")


invariance_model_11_fitindices <- fitmeasures (invariance_model_11,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_11, "Processeddata/Invariance_data/invariance_model_11_gender.rds")


#Model 12

invariance_model_12 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "lv.variances","lv.covariances","intercepts", "means"))

# invariance_model_12 <- readRDS("Processeddata/Invariance_data/invariance_model_12_gender.rds")


invariance_model_12_summary <- summary(invariance_model_12, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_12_fitindices <- fitmeasures (invariance_model_12,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_12, "Processeddata/Invariance_data/invariance_model_12_gender.rds")



#Model 13

invariance_model_13 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings","residuals", "lv.variances","lv.covariances","intercepts", "means"))

invariance_model_13_summary <- summary(invariance_model_13, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

# invariance_model_13 <- readRDS("Processeddata/Invariance_data/invariance_model_13_gender.rds")


invariance_model_13_fitindices <- fitmeasures (invariance_model_13,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_13, "Processeddata/Invariance_data/invariance_model_13_gender.rds")






models <-  list("M1" = invariance_model_1, 
                "M2" = invariance_model_2, 
                "M3" = invariance_model_3, 
                "M4" = invariance_model_4,
                "M5"=invariance_model_5,
                "M6"=invariance_model_6,
                "M7"=invariance_model_7,
                "M8"=invariance_model_8,
                "M9"=invariance_model_9,
                "M10"=invariance_model_10,
                "M11"=invariance_model_11,
                "M12"=invariance_model_12,
                "M13"=invariance_model_13)



esem_invariance.table <- compareLavaan(models,
              nesting = "M1 > M2 > M3 > M4 > M5 > M6 > M7 > M8 > M9 > M10 > M11 > M12 > M13", 
              fitmeas = c("chisq.scaled", "df",  "cfi","tli","rmsea", "rmsea.ci.lower.scaled", "rmsea.ci.upper.scaled" ),
              scaled = T,
              chidif = T, digits = 2)

colnames(esem_invariance.table) <- c("Chi-Square", "df", "CFI", "TLI", "RMSEA", "RMSEA 90% Lower CI", "RMSEA 90% Upper", "Chi-Square Difference", "df difference*", "p")



esem_invariance.table <- esem_invariance.table %>%  mutate(CFA_diff = CFI - lag(CFI),
                                                           TLI_diff= TLI- lag(TLI),
                                                           RMSEA_diff= RMSEA-lag(RMSEA),
                                                           CFI_invariance= ifelse(CFA_diff>-0.01, TRUE, FALSE),
                                                           TLI_invariance= ifelse(TLI_diff>-0.01, TRUE, FALSE),
                                                           RMSEA_invariance= ifelse(RMSEA_diff<0.01, TRUE, FALSE))

write_rds(esem_invariance.table, "Processeddata/Invariance_data/invariance_data_table_esem_gender.rds")

esem_invariance.table_scaled <- compareLavaan(models,
              nesting = "M1 > M2 > M3 > M4 > M5 > M6 > M7 > M8 > M9 > M10 > M11 > M12 > M13", 
              fitmeas = c("chisq.scaled", "df",  "cfi","tli","rmsea", "rmsea.ci.lower.scaled", "rmsea.ci.upper.scaled" ),
              scaled = T,
              chidif = T, digits = 2)

colnames(esem_invariance.table_scaled) <- c("Chi-Square", "df", "CFI", "TLI", "RMSEA", "RMSEA 90% Lower CI", "RMSEA 90% Upper", "Chi-Square Difference", "df difference*", "p")


esem_invariance_table_scaled <- esem_invariance.table_scaled %>%  mutate(CFA_diff = CFI - lag(CFI),
                                                           TLI_diff= TLI- lag(TLI),
                                                           RMSEA_diff= RMSEA-lag(RMSEA),
                                                           CFI_invariance= ifelse(CFA_diff>-0.01, TRUE, FALSE),
                                                           TLI_invariance= ifelse(TLI_diff>-0.01, TRUE, FALSE),
                                                           RMSEA_invariance= ifelse(RMSEA_diff<0.01, TRUE, FALSE))

write_rds(esem_invariance_table_scaled, "Processeddata/Invariance_data/invariance_data_table_esem_gender_scaled.rds")


full_invariance_table_gender <- readRDS("Processeddata/Invariance_data/invariance_data_table_esem_gender.rds")

```

```{r esemloading-tab}
esem_loadings <- read_excel("Processeddata/ESEM_domain_factorloadings.xlsx")
```

```{r esemloadings, results='asis'}
apa_table(esem_loadings,landscape = F, caption = "IRT Description")
```

```{r esem-domain-invariance-occupation, eval=FALSE, include=FALSE}

#Masrh  13 Model Taxonomy

# invariance_data <- cbind(descriptives$Gender,descriptives$Occupation, esem_data_2)
# 
# colnames(invariance_data)[1] <- "Gender" 
# colnames(invariance_data)[2] <- "Occupation" 
# 
# invariance_data_model <- esem_model


#Model 1
invariance_model_1 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV")


invariance_model_1_summary <- summary(invariance_model_1, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_1_fitindices <- fitmeasures (invariance_model_1,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_1, "Processeddata/Invariance_data/invariance_model_1_occupation.rds")

#Model 2: Weak/metric

invariance_model_2 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = "loadings")


invariance_model_2_summary <- summary(invariance_model_2, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_2_fitindices <- fitmeasures (invariance_model_2,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_2, "Processeddata/Invariance_data/invariance_model_2_occupation.rds")



#Model 3

invariance_model_3 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings","residuals"))

invariance_model_3_summary <- summary(invariance_model_3, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_3_fitindices <- fitmeasures (invariance_model_3,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))
            

write_rds(invariance_model_3, "Processeddata/Invariance_data/invariance_model_3_occupation.rds")



#Model 4

invariance_model_4 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings","lv.variances","lv.covariances"))

invariance_model_4_summary <- summary(invariance_model_4, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_4_fitindices <- fitmeasures (invariance_model_4,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_4, "Processeddata/Invariance_data/invariance_model_4_occupation.rds")


#Model 5: Strong/Scaler

invariance_model_5 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts"))

invariance_model_5_summary <- summary(invariance_model_5, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_5_fitindices <- fitmeasures (invariance_model_5,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_5, "Processeddata/Invariance_data/invariance_model_5_occupation.rds")


#Model 6

invariance_model_6 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings", "lv.variances","lv.covariances","residuals"))

invariance_model_6_summary <- summary(invariance_model_6, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_6_fitindices <- fitmeasures (invariance_model_6,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_6, "Processeddata/Invariance_data/invariance_model_6_occupation.rds")



#Model 7: Strict/residual

invariance_model_7 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "residuals"))

invariance_model_7_summary <- summary(invariance_model_7, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_7_fitindices <- fitmeasures (invariance_model_7,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_7, "Processeddata/Invariance_data/invariance_model_7_occupation.rds")


#Model 8

invariance_model_8 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "lv.variances","lv.covariances"))

invariance_model_8_summary <- summary(invariance_model_8, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_8_fitindices <- fitmeasures (invariance_model_8,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_8, "Processeddata/Invariance_data/invariance_model_8_occupation.rds")

#Model 9

invariance_model_9 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "lv.variances","lv.covariances","residuals"))

invariance_model_9_summary <- summary(invariance_model_9, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_9_fitindices <- fitmeasures (invariance_model_9,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_9, "Processeddata/Invariance_data/invariance_model_9_occupation.rds")


#Model 10

invariance_model_10 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "means"))

invariance_model_10_summary <- summary(invariance_model_10, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_10_fitindices <- fitmeasures (invariance_model_10,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_10, "Processeddata/Invariance_data/invariance_model_10_occupation.rds")


#Model 11

invariance_model_11 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings", "residuals","intercepts", "means"))

invariance_model_11_summary <- summary(invariance_model_11, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_11_fitindices <- fitmeasures (invariance_model_11,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_11, "Processeddata/Invariance_data/invariance_model_11_occupation.rds")


#Model 12

invariance_model_12 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings", "lv.variances","lv.covariances","intercepts", "means"))

invariance_model_12_summary <- summary(invariance_model_12, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_12_fitindices <- fitmeasures (invariance_model_12,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_12, "Processeddata/Invariance_data/invariance_model_12_occupation.rds")



#Model 13

invariance_model_13 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Occupation" ,
                  estimator = "WLSMV",
                  group.equal = c("loadings","residuals", "lv.variances","lv.covariances","intercepts", "means"))

invariance_model_13_summary <- summary(invariance_model_13, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_13_fitindices <- fitmeasures (invariance_model_13,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_13, "Processeddata/Invariance_data/invariance_model_13_occupation.rds")






models <-  list("M1" = invariance_model_1, 
                "M2" = invariance_model_2, 
                "M3" = invariance_model_3, 
                "M4" = invariance_model_4,
                "M5"=invariance_model_5,
                "M6"=invariance_model_6,
                "M7"=invariance_model_7,
                "M8"=invariance_model_8,
                "M9"=invariance_model_9,
                "M10"=invariance_model_10,
                "M11"=invariance_model_11,
                "M12"=invariance_model_12,
                "M13"=invariance_model_13)



esem_invariance.table <- compareLavaan(models,
              nesting = "M1 > M2 > M3 > M4 > M5 > M6 > M7 > M8 > M9 > M10 > M11 > M12 > M13", 
              fitmeas = c("chisq.scaled", "df",  "cfi","tli","rmsea", "rmsea.ci.lower.scaled", "rmsea.ci.upper.scaled" ),
              scaled = T,
              chidif = T, digits = 2)

colnames(esem_invariance.table) <- c("Chi-Square", "df", "CFI", "TLI", "RMSEA", "RMSEA 90% Lower CI", "RMSEA 90% Upper", "Chi-Square Difference", "df difference*", "p")



esem_invariance.table <- esem_invariance.table %>%  mutate(CFA_diff = CFI - lag(CFI),
                                                           TLI_diff= TLI- lag(TLI),
                                                           RMSEA_diff= RMSEA-lag(RMSEA),
                                                           CFI_invariance= ifelse(CFA_diff>-0.01, TRUE, FALSE),
                                                           TLI_invariance= ifelse(TLI_diff>-0.01, TRUE, FALSE),
                                                           RMSEA_invariance= ifelse(RMSEA_diff<0.01, TRUE, FALSE))

write_rds(esem_invariance.table, "Processeddata/Invariance_data/invariance_data_table_esem__occupation.rds")

esem_invariance.table_scaled <- compareLavaan(models,
              nesting = "M1 > M2 > M3 > M4 > M5 > M6 > M7 > M8 > M9 > M10 > M11 > M12 > M13", 
              fitmeas = c("chisq.scaled", "df",  "cfi","tli","rmsea", "rmsea.ci.lower.scaled", "rmsea.ci.upper.scaled" ),
              scaled = T,
              chidif = T, digits = 2)

colnames(esem_invariance.table_scaled) <- c("Chi-Square", "df", "CFI", "TLI", "RMSEA", "RMSEA 90% Lower CI", "RMSEA 90% Upper", "Chi-Square Difference", "df difference*", "p")


esem_invariance_table_scaled <- esem_invariance.table_scaled %>%  mutate(CFA_diff = CFI - lag(CFI),
                                                           TLI_diff= TLI- lag(TLI),
                                                           RMSEA_diff= RMSEA-lag(RMSEA),
                                                           CFI_invariance= ifelse(CFA_diff>-0.01, TRUE, FALSE),
                                                           TLI_invariance= ifelse(TLI_diff>-0.01, TRUE, FALSE),
                                                           RMSEA_invariance= ifelse(RMSEA_diff<0.01, TRUE, FALSE))

write_rds(esem_invariance_table_scaled, "Processeddata/Invariance_data/invariance_data_table_esem_occupation_scaled.rds")

```

```{r}
esem_invariance_data <- readRDS("Processeddata/Invariance_data/invariance_data_table_esem_gender.rds")
```

```{r esemINV, results='asis'}
apa_table(esem_invariance_data,landscape = F, caption = "IRT Description")
```

```{r esem-facet, eval=FALSE, include=FALSE}
facet_data <- esem_data_2

facet_data_total <- facet_data %>% 
  rowwise() %>%
  mutate(Soc = sum(BF1,RBF16, BF46,RBF31),
         Ass =  sum(BF21 ,RBF36 ,RBF51,BF6),
EL = sum(RBF11,BF41, BF56,RBF26),
Compassion = sum(BF2,RBF17,BF32,RBF47),
Respect = sum(BF7,RBF22,RBF37,BF52),
Trust = sum(RBF12,BF27,RBF42,BF57),
Organization = sum(RBF3 , BF18 ,BF33 ,RBF48),
Productiveness= sum(RBF8 , RBF23, BF38 ,BF53),
Responsibility = sum(BF13,RBF28,BF43,RBF58),
Anxiety=sum(RBF4 ,BF19 ,BF34 ,RBF49),
Depression=sum(RBF9,RBF24,BF39,BF54),
EV=sum(BF14 ,RBF29 ,RBF44,BF59 ),
IC = sum(BF10,RBF25,BF40,RBF55),
AS=sum(RBF5,BF20,BF35 , RBF50),
CI=sum(BF15 ,RBF30 , RBF45  ,BF60))

facet_esem_data <-   facet_data_total %>% 
  dplyr::select(Soc, Ass, EL, Compassion, Respect, Trust, Organization, Productiveness, Responsibility, Anxiety, Depression, EV, IC, AS, CI)

#creating a target matrix
target_rot_facet <- esemComp::make_target(15,#Item number
                                    mainloadings=list(
                                      Extrovert=1:3,
                                       OM=4:6,
                                      NE=7:9,
                                      Concen=10:12,
                                       Agree=13:15
                                    ))


facet_esem_tareget_efa <- esem_efa(facet_esem_data ,nfactors=5, target= target_rot_facet, fm="ml")

#Find the referent item for each factor
referents_facets <- find_referents(facet_esem_tareget_efa, factor_names = c("NE", "Concen", "Agree","OM", "Extrovert"))

#make esem model
facet_esem_model <- syntax_composer(facet_esem_tareget_efa , referents_facets)

#print model
# writeLines(esem_model)


#Fit the model
facet_esem_fit <- lavaan::cfa(facet_esem_model, facet_esem_data, estimator = "WLSMV", mimic = "Mplus", std.lv=T)

facet_esem_sumary <- summary(facet_esem_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)


fitmeasures (facet_esem_fit ,c("gfi", "agfi", "nfi","rfi", "cfi.scaled","tli.scaled","rmsea.scaled", "srmr","aic"))

# rel.esm <- reliability(esem_fit, return.total = TRUE)
# 
# rel.esm.m <- rel.esm[4,]


library("semTools")

# saveFile(esem_fit, "Figures/out4.txt","coef", tableFormat = T)


```

```{r esem-facet-invariance-gender, eval=FALSE, include=FALSE}



invariance_data <- cbind(descriptives$Gender,descriptives$Occupation, facet_esem_data)

colnames(invariance_data)[1] <- "Gender"
colnames(invariance_data)[2] <- "Occupation"

invariance_data_model <- facet_esem_model


#Model 1
invariance_model_1 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  group = "Gender",
                  estimator = "WLSMV",
                  control=list(iter.max=20000))


invariance_model_1_summary <- summary(invariance_model_1, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_1_fitindices <- fitmeasures (invariance_model_1,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_1, "Processeddata/Invariance_data/facet_invariance_model_1_gender.rds")

#Model 2: Weak/metric

invariance_model_2 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = "loadings")


invariance_model_2_summary <- summary(invariance_model_2, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_2_fitindices <- fitmeasures (invariance_model_2,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_2, "Processeddata/Invariance_data/invariance_model_2_gender.rds")



#Model 3

invariance_model_3 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings","residuals"))

invariance_model_3_summary <- summary(invariance_model_3, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_3_fitindices <- fitmeasures (invariance_model_3,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))
            

write_rds(invariance_model_3, "Processeddata/Invariance_data/invariance_model_3_gender.rds")



#Model 4

invariance_model_4 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings","lv.variances","lv.covariances"))

invariance_model_4_summary <- summary(invariance_model_4, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_4_fitindices <- fitmeasures (invariance_model_4,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_4, "Processeddata/Invariance_data/invariance_model_4_gender.rds")


#Model 5: Strong/Scaler

invariance_model_5 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts"))

invariance_model_5_summary <- summary(invariance_model_5, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_5_fitindices <- fitmeasures (invariance_model_5,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_5, "Processeddata/Invariance_data/invariance_model_5_gender.rds")


#Model 6

invariance_model_6 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "lv.variances","lv.covariances","residuals"))

invariance_model_6_summary <- summary(invariance_model_6, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_6_fitindices <- fitmeasures (invariance_model_6,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_6, "Processeddata/Invariance_data/invariance_model_6_gender.rds")



#Model 7: Strict/residual

invariance_model_7 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "residuals"))

invariance_model_7_summary <- summary(invariance_model_7, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_7_fitindices <- fitmeasures (invariance_model_7,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_7, "Processeddata/Invariance_data/invariance_model_7_gender.rds")


#Model 8

invariance_model_8 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "lv.variances","lv.covariances"))

invariance_model_8_summary <- summary(invariance_model_8, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_8_fitindices <- fitmeasures (invariance_model_8,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))

write_rds(invariance_model_8, "Processeddata/Invariance_data/invariance_model_8_gender.rds")

#Model 9

invariance_model_9 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "lv.variances","lv.covariances","residuals"))

invariance_model_9_summary <- summary(invariance_model_9, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_9_fitindices <- fitmeasures (invariance_model_9,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_9, "Processeddata/Invariance_data/invariance_model_9_gender.rds")


#Model 10

invariance_model_10 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "intercepts", "means"))

invariance_model_10_summary <- summary(invariance_model_10, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_10_fitindices <- fitmeasures (invariance_model_10,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_10, "Processeddata/Invariance_data/invariance_model_10_gender.rds")


#Model 11

invariance_model_11 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "residuals","intercepts", "means"))

invariance_model_11_summary <- summary(invariance_model_11, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_11_fitindices <- fitmeasures (invariance_model_11,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_11, "Processeddata/Invariance_data/invariance_model_11_gender.rds")


#Model 12

invariance_model_12 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings", "lv.variances","lv.covariances","intercepts", "means"))

invariance_model_12_summary <- summary(invariance_model_12, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_12_fitindices <- fitmeasures (invariance_model_12,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_12, "Processeddata/Invariance_data/invariance_model_12_gender.rds")



#Model 13

invariance_model_13 <- cfa(model = invariance_data_model,
                  data = invariance_data,
                  ordered =   names(invariance_data),
                  group = "Gender",
                  estimator = "WLSMV",
                  group.equal = c("loadings","residuals", "lv.variances","lv.covariances","intercepts", "means"))

invariance_model_13_summary <- summary(invariance_model_13, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

invariance_model_13_fitindices <- fitmeasures (invariance_model_13,c("gfi", "agfi", "nfi","rfi", 
                       "cfi","tli","cfi.scaled","tli.scaled",
                       "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","srmr"))


write_rds(invariance_model_13, "Processeddata/Invariance_data/invariance_model_13_gender.rds")






models <-  list("M1" = invariance_model_1, 
                "M2" = invariance_model_2, 
                "M3" = invariance_model_3, 
                "M4" = invariance_model_4,
                "M5"=invariance_model_5,
                "M6"=invariance_model_6,
                "M7"=invariance_model_7,
                "M8"=invariance_model_8,
                "M9"=invariance_model_9,
                "M10"=invariance_model_10,
                "M11"=invariance_model_11,
                "M12"=invariance_model_12,
                "M13"=invariance_model_13)



esem_invariance.table <- compareLavaan(models,
              nesting = "M1 > M2 > M3 > M4 > M5 > M6 > M7 > M8 > M9 > M10 > M11 > M12 > M13", 
              fitmeas = c("chisq.scaled", "df",  "cfi","tli","rmsea", "rmsea.ci.lower.scaled", "rmsea.ci.upper.scaled" ),
              scaled = T,
              chidif = T, digits = 2)

colnames(esem_invariance.table) <- c("Chi-Square", "df", "CFI", "TLI", "RMSEA", "RMSEA 90% Lower CI", "RMSEA 90% Upper", "Chi-Square Difference", "df difference*", "p")



esem_invariance.table <- esem_invariance.table %>%  mutate(CFA_diff = CFI - lag(CFI),
                                                           TLI_diff= TLI- lag(TLI),
                                                           RMSEA_diff= RMSEA-lag(RMSEA),
                                                           CFI_invariance= ifelse(CFA_diff>-0.01, TRUE, FALSE),
                                                           TLI_invariance= ifelse(TLI_diff>-0.01, TRUE, FALSE),
                                                           RMSEA_invariance= ifelse(RMSEA_diff<0.01, TRUE, FALSE))

write_rds(esem_invariance.table, "Processeddata/Invariance_data/invariance_data_table_esem_gender.rds")

esem_invariance.table_scaled <- compareLavaan(models,
              nesting = "M1 > M2 > M3 > M4 > M5 > M6 > M7 > M8 > M9 > M10 > M11 > M12 > M13", 
              fitmeas = c("chisq.scaled", "df",  "cfi","tli","rmsea", "rmsea.ci.lower.scaled", "rmsea.ci.upper.scaled" ),
              scaled = T,
              chidif = T, digits = 2)

colnames(esem_invariance.table_scaled) <- c("Chi-Square", "df", "CFI", "TLI", "RMSEA", "RMSEA 90% Lower CI", "RMSEA 90% Upper", "Chi-Square Difference", "df difference*", "p")


esem_invariance_table_scaled <- esem_invariance.table_scaled %>%  mutate(CFA_diff = CFI - lag(CFI),
                                                           TLI_diff= TLI- lag(TLI),
                                                           RMSEA_diff= RMSEA-lag(RMSEA),
                                                           CFI_invariance= ifelse(CFA_diff>-0.01, TRUE, FALSE),
                                                           TLI_invariance= ifelse(TLI_diff>-0.01, TRUE, FALSE),
                                                           RMSEA_invariance= ifelse(RMSEA_diff<0.01, TRUE, FALSE))

write_rds(esem_invariance_table_scaled, "Processeddata/Invariance_data/invariance_data_table_esem_gender_scaled.rds")

```

```{r CFA-domain, eval=FALSE, include=FALSE}
#Not accepted
big.five.model.1<- 
'Extra=~ BF1 + RBF16 + BF46+RBF31+BF21 +RBF36 +RBF51+BF6+RBF11+BF41+ BF56+RBF26
Agreeableness=~BF2+RBF17+BF32+RBF47+BF7+RBF22+RBF37+BF52+RBF12+BF27+RBF42+BF57
Cons=~RBF3 + BF18 +BF33 +RBF48+RBF8 + RBF23+ BF38 +BF53+BF13+RBF28+BF43+RBF58
NE=~RBF4 +BF19 +BF34 +RBF49+RBF9+RBF24+BF39+BF54+BF14 +RBF29 +RBF44+BF59 
OM=~BF10+RBF25+BF40+RBF55+RBF5+BF20+BF35 + RBF50+BF15 +RBF30 + RBF45  +BF60'

big.five.1.fit <-cfa(big.five.model.1, data = bigfive, estimator = "WLSMV",ordered=T, mimic = "Mplus")

big.five.sum.1 <- lavaan::summary(big.five.1.fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

big.five..fit.ind.2 <- fitmeasures (big.five.1.fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))
```

```{r CFA-facet, eval=FALSE, include=FALSE}
#Not accepted
big.five.model.1<- 
'Soc =~ BF1 + RBF16 + BF46+RBF31
Ass =~  BF21 +RBF36 +RBF51+BF6
EL =~ BF11+BF41+ BF56+RBF26
Compassion =~ BF2+RBF17+BF32+RBF47
Respect =~ BF7+RBF22+RBF37+BF52
Trust =~ RBF12+BF27+RBF42+BF57
Organization =~ RBF3 + BF18 +BF33 +RBF48
Productiveness=~ RBF8 + RBF23+ BF38 +BF53
Responsibility =~ BF13+RBF28+BF43+RBF58
Anxiety=~RBF4 +BF19 +BF34 +RBF49
Depresion=~RBF9+RBF24+BF39+BF54
EV=~BF14 +RBF29 +RBF44+BF59 
IC =~ BF10+RBF25+BF40+RBF55
AS=~RBF5+BF20+BF35 + RBF50
CI=~BF15 +RBF30 + RBF45  +BF60

Extra=~ Soc+Ass+EL
Agreeableness=~Compassion+Respect+Trust
Cons=~Organization+Productiveness+Responsibility
NE=~Anxiety+Depresion+EV
OM=~IC+AS+CI
'

big.five.1.fit <-cfa(big.five.model.1, data = bigfive, estimator = "WLSMV",ordered=T, mimic = "Mplus")

big.five.sum.1 <- lavaan::summary(big.five.1.fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

big.five..fit.ind.2 <- fitmeasures (big.five.1.fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))
```

```{r bigfive-extrovert, include=F}
## Model 1Unidimensional model: Extraversion showed low fit index
extra_model_1 <- ' extra=~ BF1 + RBF16 + BF46+RBF31+BF21 +RBF36 +RBF51+BF6+BF41+ BF56+RBF26+RBF11'

extra_model_1_fit <-cfa(extra_model_1, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_1_sum <- lavaan::summary(extra_model_1_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_1_fitindx <- fitmeasures (extra_model_1_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr"))

extra_model_1_reliability <- semTools::reliability(extra_model_1_fit, return.total = T)



## Model 1 modified RBF16, BF21, RBF31
extra_model_1_modified <- ' extra=~ BF1 +  BF46  +RBF51+BF6+BF41+ BF56+RBF26+RBF11+RBF36'

extra_model_1_modified_fit <-cfa(extra_model_1_modified, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_1_modified_sum <- lavaan::summary(extra_model_1_modified_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_1_modified_fitindx <- fitmeasures (extra_model_1_modified_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

extra_model_1_modified_reliability <- semTools::reliability(extra_model_1_modified_fit)


modfit_extra_model_1 <- modindices(extra_model_1_modified_fit, sort. = TRUE)
modfit_extra_model_1 [modfit_extra_model_1 $mi>3.84,]



## Model 2 Unidimensional model with with Acquiescence


extra_model_2 <- ' extra=~ BF1 + RBF16 + BF46+RBF31+BF21 +RBF36 +RBF51+BF6+BF41+ BF56+RBF26+RBF11

acc =~ 1*BF1 + 1*RBF16 + 1*BF46+1*RBF31+1*BF21 +1*RBF36 +1*RBF51+1*BF6+1*BF41+ 1*BF56+1*RBF26+1*RBF11
extra ~~ 0*acc'

extra_model_2_fit <-cfa(extra_model_2, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_2_sum <- lavaan::summary(extra_model_2_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_2_fitindx <- fitmeasures (extra_model_2_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

extra_model_2_reliability <- semTools::reliability(extra_model_2_fit, return.total = T)


## Model 2 modified Unidimensional model with with Acquiescence RBF16, BF21, RBF31


extra_model_2_modified <- ' extra=~ BF1 + BF46+RBF36 +RBF51+BF6+BF41+ BF56+RBF26+RBF11

acc =~ 1*BF1 + 1*BF46+1*RBF36 +1*RBF51+1*BF6+1*BF41+ 1*BF56+1*RBF26+1*RBF11
extra ~~ 0*acc'

extra_model_2_modified_fit  <-cfa(extra_model_2_modified, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_2_modified_sum <- lavaan::summary(extra_model_2_modified_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_2_modified_fitindx <- fitmeasures (extra_model_2_modified_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))


## Model 3 Extroversion: postive and negative


extra_model_3 <- ' positive=~ BF1+BF46+BF21+BF6+BF41+BF56+RBF11
negative=~ RBF16 +RBF31 +RBF36 +RBF51+RBF26
'

extra_model_3_fit <-cfa(extra_model_3, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_3_sum <- lavaan::summary(extra_model_3_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_3_fitindx <- fitmeasures (extra_model_3_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

extra_model_3_reliability <- reliability(extra_model_3_fit, return.total = T)


## Model 3 modified Extroversion: postive and negative RBF16, BF21, RBF31


extra_model_3_modified <- ' positive=~ BF1+BF46+BF6+BF41+BF56+RBF11
negative=~ RBF36 +RBF51+RBF26
'

extra_model_3_modified_fit <-cfa(extra_model_3_modified, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_3_modified_sum <- lavaan::summary(extra_model_3_modified_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_3_modified_fitindx <- fitmeasures (extra_model_3_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

extra_model_3_modified_reliability <- reliability(extra_model_3_fit, return.total = T)



## Model 4 Extroversion: Three facets


extra_model_4<- 'Soc =~ BF1 + RBF16 + BF46+RBF31
                   Ass =~  BF21 +RBF36 +RBF51+BF6
EL =~ BF41+ BF56+RBF26+RBF11
'

extra_model_4_fit <-cfa(extra_model_4, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_4_sum <- lavaan::summary(extra_model_4_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_4_fitindx <- fitmeasures (extra_model_4_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

extra_model_4_reliability <- reliability(extra_model_4_fit, return.total = T)



## Model 4 Extroversion: Three facets modified RBF16, BF21, RBF31


extra_model_4_modified<- 'Soc =~ BF1  + BF46
                   Ass =~  RBF36+RBF51+BF6
EL =~ BF41+ BF56+RBF26+RBF11
'

extra_model_4_fit_modified <-cfa(extra_model_4_modified, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_4__modified_sum <- lavaan::summary(extra_model_4_fit_modified, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_4__modified_fitindx <- fitmeasures (extra_model_4_fit_modified, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

extra_model_4__modified_reliability <- semTools::reliability(extra_model_4_fit_modified, return.total = T)


## Model 5 Extroversion: Three facets with Acquiescence


extra_model_5<- 'Soc =~ BF1 + RBF16 + BF46+RBF31
                   Ass =~  BF21 +RBF36 +RBF51+BF6
EL =~ BF41+ BF56+RBF26+RBF11
acc =~ 1*BF1 + (-1)*RBF16 + 1*BF46+ (-1)*RBF31+1*BF21 +(-1)*RBF36 +(-1)*RBF51+1*BF6+1*RBF11+1*BF41+ 1*BF56+(-1)*RBF26
Soc ~~ 0*acc
Ass~~ 0*acc
EL~~ 0*acc'

extra_model_5_fit <-cfa(extra_model_5, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_5_sum <- lavaan::summary(extra_model_5_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_5_fitindx <- fitmeasures (extra_model_5_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

extra_model_5_reliability <- reliability(extra_model_5_fit, return.total = T)






## Model 5 modified Extroversion: Three facets with Acquiescence RBF16, BF21, RBF31


extra_model_modified_5<- 'Soc =~ BF1 + BF46
                   Ass =~  RBF36 +RBF51+BF6
EL =~ BF41+ BF56+RBF26+RBF11
acc =~ 1*BF1  + 1*BF46+  +(1)*RBF36 +(1)*RBF51+1*BF6+1*RBF11+1*BF41+ 1*BF56+(1)*RBF26
Soc ~~ 0*acc
Ass~~ 0*acc
EL~~ 0*acc'

#Three facet modified with Acquiescence
extra_model_modified_5_fit <-cfa(extra_model_modified_5, data = bigfive,ordered=names(bigfive), estimator = "WLSMV", mimic = "Mplus")

extra_model_modified_5_sum <- lavaan::summary(extra_model_modified_5_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

extra_model_modified_5_fitindices <- fitmeasures (extra_model_modified_5_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))
extra_model_modified_5_reliability <- semTools::reliability(extra_model_modified_5_fit, return.total = T)


extroversion_fit_table_1 <- tabledown::cfa.tab.multi(extra_model_1_fit, extra_model_1_modified_fit,
                                                   extra_model_2_fit, extra_model_2_modified_fit, robust=F)


extroversion_fit_table_2 <- tabledown::cfa.tab.multi(extra_model_3_fit, extra_model_3_modified_fit, extra_model_4_fit, extra_model_4_fit_modified, robust=F)


extroversion_fit_table_3 <- tabledown::cfa.tab.multi(extra_model_5_fit, extra_model_modified_5_fit , robust=F)



extraversion_all_model_fit <- rbind(extroversion_fit_table_1,extroversion_fit_table_2,extroversion_fit_table_3  )




extraversion_rownames <- c("Extroversion Model 1", "Extroversion Model 1 modified","Extroversion Model 2", "Extroversion Model 2 modified",
                          "Extroversion Model 3", "Extroversion Model 3 modified", "Extroversion Model 4", "Extroversion Model 4 modified",
                          "Extroversion Model 5", "Extroversion Model 5 modified")


extraversion_all_model_fit <- as.data.frame(extraversion_all_model_fit)


rownames(extraversion_all_model_fit) <- extraversion_rownames
extraversion_all_model_fit <- rownames_to_column(extraversion_all_model_fit)

```

```{r bigfive-agree, include=F}
## Model 1 Unidimensional model:
agree_model_1 <- ' agree=~ BF2 + BF7 + RBF12 +RBF17 + RBF22 + BF27 + BF32 + RBF37 + RBF42 +  RBF47 + BF52 +BF57'

agree_model_1_fit <-cfa(agree_model_1, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

agree_model_1_sum <- lavaan::summary(agree_model_1_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

agree_model_1_fitindx <- fitmeasures (agree_model_1_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

agree_model_1_reliability <- semTools::reliability(agree_model_1_fit, return.total = T)



## Model 2 Unidimensional model with with Acquiescence


agree_model_2 <- ' agree=~BF2 + BF7 + RBF12 +RBF17 + RBF22 + BF27 + BF32 + RBF37 + RBF42 +  RBF47 + BF52 +BF57

acc=~1*BF2+1*RBF17+1*BF32+1*RBF47+1*BF7+1*RBF22+1*RBF37+1*BF52+1*RBF12+1*BF27+1*RBF42+1*BF5
agree ~~ 0*acc'

agree_model_2_fit <-cfa(agree_model_2, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

agree_model_2_sum <- lavaan::summary(agree_model_2_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

agree_model_2_fitindx <- fitmeasures (agree_model_2_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

agree_model_2_reliability <- semTools::reliability(agree_model_2_fit, return.total = T)


## Model 3 Extroversion: postive and negative


agree_model_3 <- ' positive=~ BF2 + BF7+ BF27 + BF32 + BF52 +BF57
negative=~ RBF12 +RBF17 + RBF22 + RBF37 + RBF42 +  RBF47
'

agree_model_3_fit <-cfa(agree_model_3, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

agree_model_3_sum <- lavaan::summary(agree_model_3_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

agree_model_3_fitindx <- fitmeasures (agree_model_3_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

agree_model_3_reliability <- semTools::reliability(agree_model_3_fit, return.total = T)


## Model 4: Three facets


agree_model_4<- 'Compassion =~ RBF47+BF2+RBF17+BF32
Respect =~ BF7+RBF22+RBF37+BF52
Trust =~ RBF12+BF27+RBF42+BF57
'

agree_model_4_fit <-cfa(agree_model_4, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

agree_model_4_sum <- lavaan::summary(agree_model_4_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

agree_model_4_fitindx <- fitmeasures (agree_model_4_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

agree_model_4_reliability <- semTools::reliability(agree_model_4_fit, return.total = T)




## Model 5 Extroversion: Three facets with Acquiescence


agree_model_5<- 'Compassion =~ RBF47+BF2+RBF17+BF32
Respect =~ BF7+RBF22+RBF37+BF52
Trust =~ RBF12+BF27+RBF42+BF57
acc=~1*BF2+1*RBF17+1*BF32+1*RBF47+1*BF7+1*RBF22+1*RBF37+1*BF52+1*RBF12+1*BF27+1*RBF42+1*BF57
Compassion ~~ 0*acc
Respect~~ 0*acc
Trust~~ 0*acc
'

agree_model_5_fit <-cfa(agree_model_5, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

agree_model_5_sum <- lavaan::summary(agree_model_5_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

agree_model_5_fitindx <- fitmeasures (agree_model_5_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

agree_model_5_reliability <- semTools::reliability(agree_model_5_fit, return.total = T)


agree_all_model_fit <- tabledown::cfa.tab.multi(agree_model_1_fit,                                                   agree_model_2_fit, agree_model_3_fit, agree_model_4_fit, agree_model_5_fit,  robust=F)

agree_all_model_fit <- as.data.frame(agree_all_model_fit)


agree_rownames <- c("Agree Model 1", "AgreeModel 2", 
                          "Agree Model 3",  "AgreeModel 4", 
                          "Agree Model 5")




rownames(agree_all_model_fit) <- agree_rownames
agree_all_model_fit <- rownames_to_column(agree_all_model_fit)
```

```{r bigfive-cons, include=F}
## Model 1 Unidimensional model:
cons_model_1 <- ' cons=~ RBF3 + RBF8 + BF13 + BF18 + RBF23 + RBF28 + BF33 + BF38 + BF43  + RBF48 +BF53 +RBF58
'

cons_model_1_fit <-cfa(cons_model_1, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

cons_model_1_sum <- lavaan::summary(cons_model_1_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

cons_model_1_fitindx <- fitmeasures (cons_model_1_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

cons_model_1_reliability <- semTools::reliability(cons_model_1_fit, return.total = T)



## Model 2 Unidimensional model with with Acquiescence


cons_model_2 <- ' cons=~RBF3 + RBF8 + BF13 + BF18 + RBF23 + RBF28 + BF33 + BF38 + BF43  + RBF48 +BF53 +RBF58

acc=~1*RBF3 + 1*BF18 +1*BF33+ 1*RBF48+1*RBF8 + 1*RBF23+ 1*BF38 +1*BF53+1*BF13+1*RBF28+1*BF43+1*RBF58
cons ~~ 0*acc'

cons_model_2_fit <-cfa(cons_model_2, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

cons_model_2_sum <- lavaan::summary(cons_model_2_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

cons_model_2_fitindx <- fitmeasures (cons_model_2_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

cons_model_2_reliability <- semTools::reliability(cons_model_2_fit, return.total = T)


## Model 3 Extroversion: postive and negative


cons_model_3 <- ' positive=~  BF13 + BF18 +  BF33 + BF38 + BF43   +BF53 
                  negative=~ RBF3 + RBF8  + RBF23 + RBF28 + RBF48 +RBF58'

cons_model_3_fit <-cfa(cons_model_3, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

cons_model_3_sum <- lavaan::summary(cons_model_3_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

cons_model_3_fitindx <- fitmeasures (cons_model_3_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

cons_model_3_reliability <- semTools::reliability(cons_model_3_fit, return.total = T)


## Model 4: Three facets


cons_model_4<- 'Organization =~ RBF3 + BF18 +BF33 +RBF48
Productiveness=~ RBF8 + RBF23+ BF38 +BF53
Responsibility =~ BF13+RBF28+BF43+RBF58
'

cons_model_4_fit <-cfa(cons_model_4, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

cons_model_4_sum <- lavaan::summary(cons_model_4_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

cons_model_4_fitindx <- fitmeasures (cons_model_4_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

cons_model_4_reliability <- semTools::reliability(cons_model_4_fit, return.total = T)




## Model 5 Extroversion: Three facets with Acquiescence


cons_model_5<- 'Organization =~ RBF3 + BF18 +BF33 +RBF48
Productiveness=~  RBF23+ BF38 +BF53+RBF8 
Responsibility =~ BF13+RBF28+BF43+RBF58
acc=~1*RBF3 + 1*BF18 +1*BF33+ 1*RBF48+1*RBF8 + 1*RBF23+ 1*BF38 +1*BF53+1*BF13+1*RBF28+1*BF43+1*RBF58

Organization ~~ 0*acc
Productiveness~~ 0*acc
Organization~~ 0*acc
'

cons_model_5_fit <-cfa(cons_model_5, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

cons_model_5_sum <- lavaan::summary(cons_model_5_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

cons_model_5_fitindx <- fitmeasures (cons_model_5_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

# cons_model_5_reliability <- semTools::reliability(cons_model_5_fit, return.total = T)


cons_all_model_fit <- tabledown::cfa.tab.multi(cons_model_1_fit,                                                   cons_model_2_fit, cons_model_3_fit, cons_model_4_fit, cons_model_5_fit,  robust=F)

cons_all_model_fit <- as.data.frame(cons_all_model_fit)


cons_rownames <- c("Cons Model 1", "Cons Model 2", 
                          "Cons Model 3",  "Cons Model 4", 
                          "Cons Model 5")




rownames(cons_all_model_fit) <- cons_rownames
cons_all_model_fit <- rownames_to_column(cons_all_model_fit)
```

```{r bigfive-ne, include=F}
## Model 1 Unidimensional model:
ne_model_1 <- ' ne=~ RBF4 + RBF9 + BF14 + BF19 + RBF24 + RBF29 + BF34 + BF39 +RBF44 +RBF49 +BF54 + BF59
'

ne_model_1_fit <-cfa(ne_model_1, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

ne_model_1_sum <- lavaan::summary(ne_model_1_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

ne_model_1_fitindx <- fitmeasures (ne_model_1_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

ne_model_1_reliability <- semTools::reliability(ne_model_1_fit, return.total = T)



## Model 2 Unidimensional model with with Acquiescence


ne_model_2 <- ' ne=~RBF4 + RBF9 + BF14 + BF19 + RBF24 + RBF29 + BF34 + BF39 +RBF44 +RBF49 +BF54 + BF59
acc =~1*RBF4 +1*BF19 +1*BF34 +1*RBF49+1*RBF9+1*RBF24+1*BF39+1*BF54+1*BF14 +1*RBF29 +1*RBF44+1*BF59
ne ~~ 0*acc'

ne_model_2_fit <-cfa(ne_model_2, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

ne_model_2_sum <- lavaan::summary(ne_model_2_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

ne_model_2_fitindx <- fitmeasures (ne_model_2_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

ne_model_2_reliability <- semTools::reliability(ne_model_2_fit, return.total = T)


## Model 3 Extroversion: postive and negative


ne_model_3 <- ' positive=~  BF14 + BF19 +  BF34 + BF39 +BF54 + BF59
                  negative=~ RBF4 + RBF9 + RBF24 + RBF29  +RBF44 +RBF49 '

ne_model_3_fit <-cfa(ne_model_3, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

ne_model_3_sum <- lavaan::summary(ne_model_3_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

ne_model_3_fitindx <- fitmeasures (ne_model_3_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

ne_model_3_reliability <- semTools::reliability(ne_model_3_fit, return.total = T)


## Model 4: Three facets


ne_model_4<- 'Anxiety=~RBF4 +BF19 +BF34 +RBF49
Depresion=~RBF9+RBF24+BF39+BF54
EV=~BF14 +RBF29 +RBF44+BF59 '

ne_model_4_fit <-cfa(ne_model_4, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

ne_model_4_sum <- lavaan::summary(ne_model_4_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

ne_model_4_fitindx <- fitmeasures (ne_model_4_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

ne_model_4_reliability <- semTools::reliability(ne_model_4_fit, return.total = T)




## Model 5 Extroversion: Three facets with Acquiescence


ne_model_5<- 'Anxiety=~RBF4 +BF19 +BF34 +RBF49
Depresion=~RBF9+RBF24+BF39+BF54
EV=~BF14 +RBF29 +RBF44+BF59
acc =~1*RBF4 +1*BF19 +1*BF34 +1*RBF49+1*RBF9+1*RBF24+1*BF39+1*BF54+1*BF14 +1*RBF29 +1*RBF44+1*BF59
Anxiety~~0*acc
Depresion~~0*acc
EV~~0*acc'



ne_model_5_fit <-cfa(ne_model_5, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

ne_model_5_sum <- lavaan::summary(ne_model_5_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

ne_model_5_fitindx <- fitmeasures (ne_model_5_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

ne_model_5_reliability <- semTools::reliability(ne_model_5_fit, return.total = T)


ne_all_model_fit <- tabledown::cfa.tab.multi(ne_model_1_fit,                                                   ne_model_2_fit, ne_model_3_fit, ne_model_4_fit, ne_model_5_fit,  robust=F)

ne_all_model_fit <- as.data.frame(ne_all_model_fit)


ne_rownames <- c("NE Model 1", "NE Model 2", 
                          "NE Model 3",  "NE Model 4", 
                          "NE Model 5")




rownames(ne_all_model_fit) <- ne_rownames
ne_all_model_fit <- rownames_to_column(ne_all_model_fit)
```

```{r bigfive-om, include=F}
## Model 1 Unidimensional model:
om_model_1 <- ' om=~ RBF5 + BF10 +BF15 +BF20 + RBF25 +RBF30 + BF35 +BF40 + RBF45 + RBF50 +RBF55 +BF60'

om_model_1_fit <-cfa(om_model_1, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

om_model_1_sum <- lavaan::summary(om_model_1_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

om_model_1_fitindx <- fitmeasures (om_model_1_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

om_model_1_reliability <- semTools::reliability(om_model_1_fit, return.total = T)



## Model 2 Unidimensional model with with Acquiescence


om_model_2 <- ' om=~RBF5 + BF10 +BF15 +BF20 + RBF25 +RBF30 + BF35 +BF40 + RBF45 + RBF50 +RBF55 +BF60
acc =~1*BF10+1*RBF25+1*BF40+1*RBF55+1*RBF5+1*BF20+1*BF35 + 1*RBF50+1*BF15 +1*RBF30 + 1*RBF45  +1*BF60
om ~~ 0*acc'

om_model_2_fit <-cfa(om_model_2, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

om_model_2_sum <- lavaan::summary(om_model_2_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

om_model_2_fitindx <- fitmeasures (om_model_2_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

om_model_2_reliability <- semTools::reliability(om_model_2_fit, return.total = T)


## Model 3 Extroversion: postive and omgative


om_model_3 <- ' positive=~  BF10 +BF15 +BF20 + BF35 +BF40  +BF60
                  omgative=~ RBF5 + RBF25 +RBF30 + RBF45 + RBF50 +RBF55 '

om_model_3_fit <-cfa(om_model_3, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

om_model_3_sum <- lavaan::summary(om_model_3_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

om_model_3_fitindx <- fitmeasures (om_model_3_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

om_model_3_reliability <- semTools::reliability(om_model_3_fit, return.total = T)


## Model 4: Three facets


om_model_4<- 'IC =~ BF10+RBF25+BF40+RBF55
AS=~RBF5++BF20+BF35 + RBF50
CI=~BF15 +RBF30 +   RBF45  +BF60

'

om_model_4_fit <-cfa(om_model_4, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

om_model_4_sum <- lavaan::summary(om_model_4_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

om_model_4_fitindx <- fitmeasures (om_model_4_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

om_model_4_reliability <- semTools::reliability(om_model_4_fit, return.total = T)




## Model 5 Extroversion: Three facets with Acquiescence


om_model_5<- 'IC =~ BF10+RBF25+BF40+RBF55
AS=~RBF5++BF20+BF35 + RBF50
CI=~BF15 +RBF30 +   RBF45  +BF60
acc=~1*BF10+1*RBF25+1*BF40+1*RBF55+1*RBF5+1*BF20+1*BF35 + 1*RBF50+1*BF15 +1*RBF30 + 1*RBF45  +1*BF60
IC~~0*acc
AS~~0*acc
CI~~0*acc'



om_model_5_fit <-cfa(om_model_5, data = bigfive, ordered = names(bigfive), estimator = "WLSMV", mimic = "Mplus")

om_model_5_sum <- lavaan::summary(om_model_5_fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

om_model_5_fitindx <- fitmeasures (om_model_5_fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))

om_model_5_reliability <- semTools::reliability(om_model_5_fit, return.total = T)


om_all_model_fit <- tabledown::cfa.tab.multi(om_model_1_fit,                                                   om_model_2_fit, om_model_3_fit, om_model_4_fit, om_model_5_fit,  robust=F)

om_all_model_fit <- as.data.frame(om_all_model_fit)


om_rownames <- c("OM Model 1", "OM Model 2", 
                          "OM Model 3",  "OM Model 4", 
                          "OM Model 5")




rownames(om_all_model_fit) <- om_rownames
om_all_model_fit <- rownames_to_column(om_all_model_fit)
```



```{r cfa-facet, include=F}
facet_cfa <- rbind(extraversion_all_model_fit,agree_all_model_fit,cons_all_model_fit,
                   ne_all_model_fit,om_all_model_fit)
```

```{r cfa-tab, results='asis'}
apa_table(facet_cfa,landscape = F, caption = "IRT Description")
```

```{r netwrok,eval=FALSE}
library(bootnet)
library(snow)
network_data <-  esem_data_2 %>% dplyr::select(BF1, RBF16,BF46,RBF31,BF21, RBF36, RBF51,BF6,BF11,BF41, BF56,RBF26)

net_modSelect <- estimateNetwork(network_data, 
              default = "ggmModSelect",
              stepwise = FALSE,
              corMethod = "cor")


traits <- c("F1","F1","F1","F1","F2","F2","F2","F2","F3","F3","F3","F3")


items <- colnames(network_data)

network_plot <-  plot(net_modSelect, 
     layout = "spring",
     groups = traits,
     label.cex = 0.7, # scalar on label size
     label.color = 'blue', # string on label colors
     label.prop = 0.9, # proportion of the width of the node that the label scales
     
     # Edges (pp. 33-34)
     negDashed = T, # should negative edges be dashed?
     
     # Legend (p. 35-36)
     legend.cex = 0.27, # scalar of the legend
     legend.mode = 'style2', # default is 'style1'
     nodeNames = items, # names for each node to plot in legend
     
     # Generical graphical arguments (p. 36)
     font = 2)


qgraph::centralityPlot(net_modSelect, include = "all", orderBy = "ExpectedInfluence")
# 
# bootnet_case_dropping <- bootnet(net_modSelect, 
#                                  nBoots = 2500,
#                                  type = "case",
#                                  nCores = 8)
# 
# # write_rds(bootnet_case_dropping, "ProcessdData/network_boot_2500.rds")
# 
# boot_data <- readRDS("ProcessdData/network_boot_2500.rds")
# plot(boot_data, 'all')


# gvar_boot <- bootnet(net_modSelect, nBoots = 10, nCores = 8)
# plot(gvar_boot, graph = "contemporaneous", plot = "interval")
# 
# plot(gvar_boot,order="sample", plot="area", prop0=TRUE)
# plot(gvar_boot, order="sample", plot="difference", onlyNonZero=TRUE)
# plot(gvar_boot, plot = "interval", split0 = TRUE, order="sample", labels=FALSE)


```

```{r Big-five-SO-CFA, eval=FALSE, include=FALSE}
#Not accepted
big.five.model.1<- 
'Soc =~ BF1 + RBF16 + BF46+RBF31
Ass =~  BF21 +RBF36 +RBF51+BF6
EL =~ BF11+BF41+ BF56+RBF26
Compassion =~ BF2+RBF17+BF32+RBF47
Respect =~ BF7+RBF22+RBF37+BF52
Trust =~ RBF12+BF27+RBF42+BF57
Organization =~ RBF3 + BF18 +BF33 +RBF48
Productiveness=~ RBF8 + RBF23+ BF38 +BF53
Responsibility =~ BF13+RBF28+BF43+RBF58
Anxiety=~RBF4 +BF19 +BF34 +RBF49
Depresion=~RBF9+RBF24+BF39+BF54
EV=~BF14 +RBF29 +RBF44+BF59 
IC =~ BF10+RBF25+BF40+RBF55
AS=~RBF5+BF20+BF35 + RBF50
CI=~BF15 +RBF30 + RBF45  +BF60

acc=~1*BF1 + 1*RBF16 + 1*BF46+ 1*RBF31+1*BF21 +1*RBF36 +1*RBF51+1*BF6+1*BF11+1*BF41+ 1*BF56+1*RBF26+1*BF2+1*RBF17+1*BF32+1*RBF47+1*BF7+1*RBF22+1*RBF37+1*BF52+1*RBF12+1*BF27+1*RBF42+1*BF57+1*RBF3 + 1*BF18 +1*BF33+ 1*RBF48+1*RBF8 + 1*RBF23+ 1*BF38 +1*BF53+1*BF13+1*RBF28+1*BF43+1*RBF58+1*RBF4 +1*BF19 +1*BF34 +1*RBF49+1*RBF9+1*RBF24+1*BF39+1*BF54+1*BF14 +1*RBF29 +1*RBF44+1*BF59+1*RBF4 +1*BF19 +1*BF34 +1*RBF49+1*RBF9+1*RBF24+1*BF39+1*BF54+1*BF14 +1*RBF29 +1*RBF44+1*BF59+1*BF10+1*RBF25+1*BF40+1*RBF55+1*RBF5+1*BF20+1*BF35 + 1*RBF50+1*BF15 +1*RBF30 + 1*RBF45  +1*BF60


Extra=~ Soc+Ass+EL
Agreeableness=~Compassion+Respect+Trust
Cons=~Organization+Productiveness+Responsibility
NE=~Anxiety+Depresion+EV
OM=~IC+AS+CI
Soc~~0*acc
Ass~~0*acc
EL~~0*acc
Compassion~~0*acc
Respect~~0*acc
Trust~~0*acc
Organization~~0*acc
Productiveness~~0*acc
Responsibility~~0*acc
Anxiety~~0*acc
Depresion~~0*acc
EV~~0*acc
IC~~0*acc
AS~~0*acc
CI~~0*acc
'

big.five.1.fit <-cfa(big.five.model.1, data = bigfive, estimator = "WLSMV",ordered=T, mimic = "Mplus")

big.five.sum.1 <- lavaan::summary(big.five.1.fit, fit.measures =TRUE,standardized = TRUE, rsq =TRUE)

big.five..fit.ind.2 <- fitmeasures (big.five.1.fit, c("gfi", "agfi", "nfi","rfi", "cfi","tli","rmsea", "srmr","aic"))
```

```{r IRT-data-set-up, eval=F}
library(paran)
esem_data <- bigfive %>% 
  dplyr::select(BF1, BF6, RBF11,RBF16, BF21, RBF26, RBF31, RBF36, BF41 ,BF46 , RBF51 , BF56,
                
        BF2 , BF7 , RBF12 ,RBF17 , RBF22 , BF27 , BF32 , RBF37 , RBF42 ,  RBF47 , BF52 ,BF57, 
        RBF3 , RBF8 , BF13 , BF18 , RBF23 , RBF28 , BF33 , BF38 , BF43  , RBF48 ,BF53 ,RBF58,
        
        RBF4 , RBF9 , BF14 , BF19 , RBF24 , RBF29 , BF34 , BF39 ,RBF44 ,RBF49 ,BF54 , BF59,
         
        RBF5 , BF10 ,BF15 ,BF20 , RBF25 ,RBF30 , BF35 ,BF40 , RBF45 , RBF50 ,RBF55 ,BF60)


esem_data_2 <- as.data.frame(lapply(esem_data, as.numeric))

extroversion <- esem_data_2 %>% dplyr::select(BF1, BF46, RBF36, RBF51,BF6, RBF11,BF41, BF56,RBF26)


agreebleness <-   esem_data_2 %>% dplyr::select(BF2,RBF17,BF32,RBF47, BF7,RBF22,RBF37,BF52, RBF12,BF27,RBF42,BF57)

conscientiousness<-   esem_data_2 %>% dplyr::select(RBF3 , BF18 ,BF33 ,RBF48, RBF8 , RBF23, BF38 ,BF53, BF13,RBF28,BF43,RBF58)



negative_emotionality<-   esem_data_2 %>% dplyr::select(RBF4 ,BF19 ,BF34 ,RBF49,RBF9,RBF24,BF39,BF54,BF14 ,RBF29 ,RBF44,BF59 )


open_mind <-   esem_data_2 %>% dplyr::select(BF10,RBF25,BF40,RBF55, RBF5,BF20,BF35 , RBF50,BF15 ,RBF30 , RBF45  ,BF60)


extroversion_Horn <- paran(extroversion, iterations=500, centile=0, quietly=FALSE,
           status=TRUE, all=FALSE, cfa=FALSE, graph=TRUE,
           color=TRUE, col=c("black","red","blue"),
           lty=c(1,2,3), lwd=1, legend=TRUE, 
           width=640, height=640, grdevice=png, seed=0, mat=NA)

agreebleness_Horn <- paran(agreebleness, iterations=500, centile=0, quietly=FALSE,
           status=TRUE, all=FALSE, cfa=FALSE, graph=TRUE,
           color=TRUE, col=c("black","red","blue"),
           lty=c(1,2,3), lwd=1, legend=TRUE, 
           width=640, height=640, grdevice=png, seed=0, mat=NA)

conscientiousness_Horn <- paran(conscientiousness, iterations=500, centile=0, quietly=FALSE,
           status=TRUE, all=FALSE, cfa=FALSE, graph=TRUE,
           color=TRUE, col=c("black","red","blue"),
           lty=c(1,2,3), lwd=1, legend=TRUE, 
           width=640, height=640, grdevice=png, seed=0, mat=NA)

negative_emotionality_Horn <- paran(negative_emotionality, iterations=500, centile=0, quietly=FALSE,
           status=TRUE, all=FALSE, cfa=FALSE, graph=TRUE,
           color=TRUE, col=c("black","red","blue"),
           lty=c(1,2,3), lwd=1, legend=TRUE, 
           width=640, height=640, grdevice=png, seed=0, mat=NA)

open_mind_Horn <- paran(open_mind, iterations=500, centile=0, quietly=FALSE,
           status=TRUE, all=FALSE, cfa=FALSE, graph=TRUE,
           color=TRUE, col=c("black","red","blue"),
           lty=c(1,2,3), lwd=1, legend=TRUE, 
           width=640, height=640, grdevice=png, seed=0, mat=NA)

```

```{r Bigfive-irt, include=F}
#15 Facet df
bigfive <- as.data.frame(lapply(bigfive, as.numeric))

Soc <- bigfive %>% dplyr::select(BF1, RBF16,BF46,RBF31)
Ass <-  bigfive %>% dplyr::select(BF21, RBF36, RBF51,BF6)
EL <-  bigfive %>% dplyr::select(RBF11,BF41, BF56,RBF26)
Compassion <-  bigfive %>% dplyr::select(BF2,RBF17,BF32,RBF47)
Respect <-  bigfive %>% dplyr::select(BF7,RBF22,RBF37,BF52)
Trust <-  bigfive %>% dplyr::select(RBF12,BF27,RBF42,BF57)
Organization <-  bigfive %>% dplyr::select(RBF3 , BF18 ,BF33 ,RBF48)
Productiveness<-  bigfive %>% dplyr::select(RBF8 , RBF23, BF38 ,BF53)
Responsibility <-  bigfive %>% dplyr::select(BF13,RBF28,BF43,RBF58)
Anxiety<-  bigfive %>% dplyr::select(RBF4 ,BF19 ,BF34 ,RBF49)
Depresion<-  bigfive %>% dplyr::select(RBF9,RBF24,BF39,BF54)
EV<-  bigfive %>% dplyr::select(BF14 ,RBF29 ,RBF44,BF59 )
IC <-  bigfive %>% dplyr::select(BF10,RBF25,BF40,RBF55)
AS<-  bigfive %>% dplyr::select(RBF5,BF20,BF35 , RBF50)
CI<-  bigfive %>% dplyr::select(BF15 ,RBF30 , RBF45  ,BF60)

#Model fit
soc.fit <- mirt(Soc , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

ass.fit <- mirt(Ass , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

el.fit <- mirt(EL , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

comp.fit <- mirt(Compassion , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

resp.fit <- mirt(Respect , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))


trust.fit <- mirt(Trust , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))


org.fit <- mirt(Organization , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

prod.fit <- mirt(Productiveness , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

rsps.fit <- mirt(Responsibility , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

anx.fit <- mirt(Anxiety , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

dep.fit <- mirt(Depresion , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

ev.fit <- mirt(EV , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

ic.fit <- mirt(IC , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

as.fit <- mirt(AS , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

ci.fit <- mirt(CI , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

# Model Parameters 

##Sociability
soc.params <- coef(soc.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
soc.items <- data.frame(soc.params$items)
soc_item_arranged <- arrange(soc.items, desc(a) )
# Selected items RBF16 & BF46

##Assertiveness
ass.params <- coef(ass.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
ass.items <- data.frame(ass.params$items)
ass_item_arranged <- arrange(ass.items, desc(a) )
# Selected items  BF21 & RBF36 

##Energy level
el.params <- coef(el.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
el.items <- data.frame(el.params$items)
el_item_arranged <- arrange(el.items, desc(a) )
# Selected items BF41 & RBF11

##Compassion
comp.params <- coef(comp.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
comp.items <- data.frame(comp.params$items)
comp_item_arranged <- arrange(comp.items, desc(a) )
# Selected items RBF17 & BF32

##Respectfulness
resp.params <- coef(resp.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
resp.items <- data.frame(resp.params$items)
resp_item_arranged <- arrange(resp.items, desc(a) )
# Selected items BF52 & RBF22

##Trust
trust.params <- coef(trust.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
trust.items <- data.frame(trust.params$items)
trust_item_arranged <- arrange(trust.items, desc(a) )
# Selected items RBF12 & BF57

##Organization
org.params <- coef(org.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
org.items <- data.frame(org.params$items)
org_item_arranged <- arrange(org.items, desc(a) )
# Selected items BF33 & RBF3

##Productiveness
prod.params <- coef(prod.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
prod.items <- data.frame(prod.params$items)
prod_item_arranged <- arrange(prod.items, desc(a) )
# Selected items RBF23 & BF38


##Responsibility
rsps.params <- coef(rsps.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
rsps.items <- data.frame(rsps.params$items)
rsps_item_arranged <- arrange(rsps.items, desc(a) )
# Selected items RBF58 & BF43

##Anxiety
anx.params <- coef(anx.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
anx.items <- data.frame(anx.params$items)
anx_item_arranged <- arrange(anx.items, desc(a) )
# Selected items BF34 & RBF4

##Depression
dep.params <- coef(dep.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
dep.items <- data.frame(dep.params$items)
dep_item_arranged <- arrange(dep.items, desc(a) )
# Selected items BF39 & RBF24



##Emotional Volatility
ev.params <- coef(ev.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
ev.items <- data.frame(ev.params$items)
ev_item_arranged <- arrange(ev.items, desc(a) )
# Selected items RBF29 & BF59

##Intellectual Curiosity
ic.params <- coef(ic.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
ic.items <- data.frame(ic.params$items)
ic_item_arranged <- arrange(ic.items, desc(a) )
# Selected items RBF25 & BF10

##Aesthetic Sensitivity
as.params <- coef(as.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
as.items <- data.frame(as.params$items)
as_item_arranged <- arrange(as.items, desc(a) )
# Selected items BF20 & RBF50

##Creative Imagination
ci.params <- coef(ci.fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
ci.items <- data.frame(ci.params$items)
ci_item_arranged <- arrange(ci.items, desc(a) )
# Selected items RBF30 & BF15

all_items_paraeters <- rbind(soc.items,ass.items,el.items,comp.items,
                             resp.items,trust.items,org.items,
                             prod.items, rsps.items, anx.items, dep.items,ev.items, ic.items,
                             as.items,ci.items )

# Item Fit

#RMSEA >=.06
soc.item.fit<- itemfit(soc.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
ass.item.fit<- itemfit(ass.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
el.item.fit<- itemfit(el.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
comp.item.fit<- itemfit(comp.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
resp.item.fit<- itemfit(resp.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
trust.item.fit<- itemfit(trust.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
org.item.fit<- itemfit(org.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
prod.item.fit<- itemfit(prod.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
rsps.item.fit<- itemfit(rsps.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
anx.item.fit<- itemfit(anx.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
dep.item.fit<- itemfit(dep.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
ev.item.fit<- itemfit(ev.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
ic.item.fit<- itemfit(ic.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
as.item.fit<- itemfit(as.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
ci.item.fit<- itemfit(ci.fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)

all_item_fit <- rbind(soc.item.fit, ass.item.fit,el.item.fit,comp.item.fit,
                     resp.item.fit,trust.item.fit,org.item.fit,
                     prod.item.fit,rsps.item.fit,anx.item.fit,dep.item.fit,
                     ev.item.fit,ic.item.fit,as.item.fit,ci.item.fit )

all_item_irt <- cbind(all_items_paraeters,all_item_fit)
#Identifying Missfit items based on RMSEA Value
soc.item_misfits <- subset(soc.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
ass.item_misfits <- subset(ass.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
el.item_misfits <- subset(el.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
comp.item_misfits <- subset(comp.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
resp.item_misfits <- subset(resp.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
trust.item_misfits <- subset(trust.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
org.item_misfits <- subset(org.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
prod.item_misfits <- subset(prod.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
rsps.item_misfits <- subset(rsps.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
anx.item_misfits <- subset(anx.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
dep.item_misfits <- subset(dep.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
ev.item_misfits <- subset(ev.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
ic.item_misfits <- subset(ic.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
as.item_misfits <- subset(as.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
ci.item_misfits <- subset(ci.item.fit, outfit>1.4| infit>1.4| RMSEA.S_X2 >= .06)
```



```{r}
#Item discrimination
very.low <- sum(all_item_irt$a >=.10 & all_item_irt$a<.34, na.rm=TRUE)
low <- sum(all_item_irt$a >=.34 & all_item_irt$a<.64, na.rm=TRUE)
moderate <- sum(all_item_irt$a >=.64 & all_item_irt$a<1.34, na.rm=TRUE)
high <- sum(all_item_irt$a >=1.34 & all_item_irt$a<1.69, na.rm=TRUE)
very.high <- sum(all_item_irt$a >=1.69, na.rm=TRUE)

all_item_irt$Dif_categorization <- ifelse(all_item_irt$a >=.10 & all_item_irt$a<.34, "Very Low",
                                                 ifelse(all_item_irt$a >=.34 & all_item_irt$a<.64,"Low",
                                                        ifelse(all_item_irt$a >=.64 & all_item_irt$a<1.34,"Moderate",
                                                               ifelse(all_item_irt$a >=1.34 & all_item_irt$a<1.69,"High",
                                                                      ifelse(all_item_irt$a >=1.69, "Very High", NA)))))
```


```{r bigf2xs-s, eval=FALSE, include=FALSE}
big_five_2_s <- bigfive %>% 
  dplyr::select(RBF16, BF46, BF21, RBF36, BF41, RBF11,
                RBF17, BF32, BF52, RBF22, RBF12, BF57,
                BF33, RBF3,RBF23, BF38, RBF58, BF43,
                BF34, RBF4, BF39, RBF24, RBF29, BF59,
                RBF25, BF10, BF20,RBF50,RBF30, BF15 )

big_five_2_xs <- bigfive %>% 
  dplyr::select(RBF16,  BF21,  BF41, 
                RBF17, BF52,RBF12, 
                BF33, RBF23,  RBF58,
                BF34, BF39,  RBF29, 
                RBF25,  BF20,RBF30  )



extroversion_rel_data_s <- big_five_2_s  %>% dplyr::select(RBF16, BF46, BF21, RBF36, BF41, RBF11)

agreebleness_rel_data_s <-   big_five_2_s  %>% dplyr::select(RBF17, BF32, BF52, RBF22, RBF12, BF57)

conscientiousness_rel_data_s<-  big_five_2_s  %>% dplyr::select(BF33, RBF3,RBF23, BF38, RBF58, BF43)

negative_emotionality_rel_data_s<-   big_five_2_s  %>% dplyr::select(BF34, RBF4, BF39, RBF24, RBF29, BF59)

open_mind_rel_data_s <-   big_five_2_s  %>% dplyr::select(RBF25, BF10, BF20,RBF50,RBF30, BF15)

extroversion_rel_data_xs <- big_five_2_s  %>% dplyr::select(RBF16,  BF21,  BF41)

agreebleness_rel_data_xs <-   big_five_2_s  %>% dplyr::select(RBF17, BF52,RBF12)

conscientiousness_rel_data_xs<-  big_five_2_s  %>% dplyr::select(BF33, RBF23,  RBF58)

negative_emotionality_rel_data_xs<-   big_five_2_s  %>% dplyr::select(BF34, BF39,  RBF29)

open_mind_rel_data_xs <-   big_five_2_s  %>% dplyr::select(RBF25,  BF20,RBF30)




#S
extroversion_alpha_s <- coefficientalpha::alpha(extroversion_rel_data_s)

agreebleness_alpha_s <- coefficientalpha::alpha(agreebleness_rel_data_s)

conscientiousness_alpha_s <- coefficientalpha::alpha(conscientiousness_rel_data_s)

negative_emotionality_alpha_s <- coefficientalpha::alpha(negative_emotionality_rel_data_s)

open_mind_alpha_s <- coefficientalpha::alpha(open_mind_rel_data_s)



extroversion_alpha_ordinal_s <- psych::alpha(polychoric(extroversion_rel_data_s)$rho)

agreebleness_alpha_ordinal_s <- psych::alpha(polychoric(agreebleness_rel_data_s)$rho)

conscientiousness_alpha_ordinal_s <- psych::alpha(polychoric(conscientiousness_rel_data_s)$rho)

negative_emotionality_alpha_ordinal_s <- psych::alpha(polychoric(negative_emotionality_rel_data_s)$rho)

open_mind_alpha_ordinal_s <- psych::alpha(polychoric(open_mind_rel_data_s)$rho)



extroversion_omega_s <- coefficientalpha::omega(extroversion_rel_data_s)

agreebleness_omega_s <- coefficientalpha::omega(agreebleness_rel_data_s)

conscientiousness_omega_s <- coefficientalpha::omega(conscientiousness_rel_data_s)

negative_emotionality_omega_s <- coefficientalpha::omega(negative_emotionality_rel_data_s)

open_mind_alpha_omega_s <- coefficientalpha::omega(open_mind_rel_data_s)



#XS

extroversion_alpha_xs <- coefficientalpha::alpha(extroversion_rel_data_xs)

agreebleness_alpha_xs <- coefficientalpha::alpha(agreebleness_rel_data_xs)

conscientiousness_alpha_xs <- coefficientalpha::alpha(conscientiousness_rel_data_xs)

negative_emotionality_alpha_xs <- coefficientalpha::alpha(negative_emotionality_rel_data_xs)

open_mind_alpha_xs <- coefficientalpha::alpha(open_mind_rel_data_xs)


extroversion_alpha_ordinal_xs <- psych::alpha(polychoric(extroversion_rel_data_xs)$rho)

agreebleness_alpha_ordinal_xs <- psych::alpha(polychoric(agreebleness_rel_data_xs)$rho)

conscientiousness_alpha_ordinal_xs <- psych::alpha(polychoric(conscientiousness_rel_data_xs)$rho)

negative_emotionality_alpha_ordinal_xs <- psych::alpha(polychoric(negative_emotionality_rel_data_xs)$rho)

open_mind_alpha_ordinal_xs <- psych::alpha(polychoric(open_mind_rel_data_xs)$rho)



# extroversion_omega_xs <- coefficientalpha::omega(extroversion_rel_data_xs)
# 
# agreebleness_omega_xs <- coefficientalpha::omega(agreebleness_rel_data_xs)
# 
# conscientiousness_omega_xs <- coefficientalpha::omega(conscientiousness_rel_data_xs)
# 
# negative_emotionality_omega_xs <- coefficientalpha::omega(negative_emotionality_rel_data_xs)
# 
# open_mind_alpha_omega_xs <- coefficientalpha::omega(open_mind_rel_data_xs)


  
```





```{r IRT-tab1, results='asis'}
apa_table(all_item_irt,landscape = F, caption = "IRT Description")
```


```{r IRT-plots, eval=FALSE, include=FALSE}
#Only for inspection


#Item Info
soc.info_plot <- plot(soc.fit, type = "infotrace", facet =T, main = "Sociability")

ass.info_plot <- plot(ass.fit, type = "infotrace", facet =T, main = "Assertiveness")
el.info_plot <- plot(el.fit, type = "infotrace", facet =T, main = "Energy Level")
comp.info_plot <- plot(comp.fit, type = "infotrace", facet =T, main = "Compassion")
resp.info_plot <- plot(resp.fit, type = "infotrace", facet =T, main = "Respectfulness")
trust.info_plot <- plot(trust.fit, type = "infotrace", facet =T, main = "Trust")
org.info_plot<- plot(org.fit, type = "infotrace", facet =T, main = "Organization")
prod.info_plot <- plot(prod.fit, type = "infotrace", facet =T, main = "Productiveness")
rsps.info_plot <- plot(rsps.fit, type = "infotrace", facet =T, main = "Responsibility")
anx.info_plot <- plot(anx.fit, type = "infotrace", facet =T, main = "Anxiety")
dep.info_plot <- plot(dep.fit, type = "infotrace", facet =T, main = "Depression")
ev.info_plot <- plot(ev.fit, type = "infotrace", facet =T, main = "Emotional Volatility")
ic.info_plot <- plot(ic.fit, type = "infotrace", facet =T, main = "Intellectual Curiosity")
as.info_plot <- plot(as.fit, type = "infotrace", facet =T, main = "Aesthetic Sensitivity")
ci.info_plot <- plot(ci.fit, type = "infotrace", facet =T, main = "Creative Imagination")



#Test Info
soc.info_plot <- plot(soc.fit, type = "infoSE", facet =T, main = "Sociability")

ass.info_plot <- plot(ass.fit, type = "infoSE", facet =T, main = "Assertiveness")
el.info_plot <- plot(el.fit, type = "infoSE", facet =T, main = "Energy Level")
comp.info_plot <- plot(comp.fit, type = "infoSE", facet =T, main = "Compassion")
resp.info_plot <- plot(resp.fit, type = "infoSE", facet =T, main = "Respectfulness")
trust.info_plot <- plot(trust.fit, type = "infoSE", facet =T, main = "Trust")
org.info_plot<- plot(org.fit, type = "infoSE", facet =T, main = "Organization")
prod.info_plot <- plot(prod.fit, type = "infoSE", facet =T, main = "Productiveness")
rsps.info_plot <- plot(rsps.fit, type = "infoSE", facet =T, main = "Responsibility")
anx.info_plot <- plot(anx.fit, type = "infoSE", facet =T, main = "Anxiety")
dep.info_plot <- plot(dep.fit, type = "infoSE", facet =T, main = "Depression")
ev.info_plot <- plot(ev.fit, type = "infoSE", facet =T, main = "Emotional Volatility")
ic.info_plot <- plot(ic.fit, type = "infoSE", facet =T, main = "Intellectual Curiosity")
as.info_plot <- plot(as.fit, type = "infoSE", facet =T, main = "Aesthetic Sensitivity")
ci.info_plot <- plot(ci.fit, type = "infoSE", facet =T, main = "Creative Imagination")

```

```{r Bigfive-domain-irt,eval=FALSE}
#5 domain
extroversion <- esem_data_2 %>% dplyr::select(BF1, BF46, RBF36, RBF51,BF6, BF11,BF41, BF56,RBF26)


agreebleness <-  esem_data_2 %>% dplyr::select(BF2,RBF17,BF32,RBF47, BF7,RBF22,RBF37,BF52, RBF12,BF27,RBF42,BF57)

conscientiousness<-  bigfive %>% dplyr::select(RBF3 , BF18 ,BF33 ,RBF48, RBF8 , RBF23, BF38 ,BF53, BF13,RBF28,BF43,RBF58)



negative_emotionality<-  esem_data_2 %>% dplyr::select(RBF4 ,BF19 ,BF34 ,RBF49,RBF9,RBF24,BF39,BF54,BF14 ,RBF29 ,RBF44,BF59 )


open_mind <-  esem_data_2 %>% dplyr::select(BF10,RBF25,BF40,RBF55, RBF5,BF20,BF35 , RBF50,BF15 ,RBF30 , RBF45  ,BF60)

# monotonocity_extroversion <- mokken::check.monotonicity(extroversion )
# monotonocity_extroversion_results <- monotonocity_extroversion$results
# summary(monotonocity_extroversion)
#Model fit
extroversion_fit <- mirt(extroversion  , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

agreebleness_fit <- mirt(agreebleness , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

conscientiousness_fit <- mirt(conscientiousness , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

negative_emotionality_fit <- mirt(negative_emotionality , model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))

open_mind_fit <- mirt(open_mind, model = 1, itemtype = 'graded', 
               SE = TRUE, Se.type = 'MHRM',
               technical = list(NCYCLES = 10000))



# #M2
# extroversion_m2 <- M2(extroversion_fit)
# agreebleness_m2 <- M2(agreebleness_fit)
# conscientiousness_m2 <- M2(conscientiousness_fit)
# negative_emotionality_m2 <- M2(negative_emotionality_fit)
# 
# open_mind_m2 <- M2(open_mind_fit)

# Model Parameters 

##extroversion
extroversion_params <- coef(extroversion_fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
extroversion_items <- data.frame(extroversion_params$items)

##agreebleness
agreebleness_params <- coef(agreebleness_fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
agreebleness_items <- data.frame(agreebleness_params$items)

##conscientiousness
conscientiousness_params <- coef(conscientiousness_fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
conscientiousness_items <- data.frame(conscientiousness_params$items)

##negative_emotionality
negative_emotionality_params <- coef(negative_emotionality_fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
negative_emotionality_items <- data.frame(negative_emotionality_params$items)

##open_mind
open_mind_params <- coef(open_mind_fit, IRTpars = TRUE, simplify = TRUE, rawug = FALSE) 
open_mind_items <- data.frame(open_mind_params$items)



# Item Fit

#RMSEA >=.06
extroversion_item_fit<- itemfit(extroversion_fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
agreebleness_item_fit<- itemfit(agreebleness_fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
conscientiousness_item_fit<- itemfit(conscientiousness_fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
negative_emotionality_item_fit<- itemfit(negative_emotionality_fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)
open_mind_item_fit<- itemfit(open_mind_fit, fit_stats = c("S_X2", "G2","Zh", "infit"),impute=10)



#Identifying Missfit items based on RMSEA Value
extroversion_item_misfits <- subset(extroversion_item_fit, RMSEA.S_X2 >= .06)
agreebleness_item_misfits <- subset(agreebleness_item_fit, RMSEA.S_X2 >= .06)
conscientiousness_item_misfits <- subset(conscientiousness_item_fit, RMSEA.S_X2 >= .06)
negative_emotionality_item_misfits <- subset(negative_emotionality_item_fit, RMSEA.S_X2 >= .06)
open_mind_item_fit_misfits <- subset(open_mind_item_fit, RMSEA.S_X2 >= .06)




#Only for inspection

#Item Information curve
extroversion_info_plot <- plot(extroversion_fit, type = "infotrace", facet =T, main = "Sociability")

agreebleness_info_plot <- plot(agreebleness_fit, type = "infotrace", facet =T, main = "Assertiveness")

conscientiousness_info_plot <- plot(conscientiousness_fit, type = "infotrace", facet =T, main = "Compassion")
negative_emotionality_info_plot <- plot(negative_emotionality_fit, type = "infotrace", facet =T, main = "Respectfulness")

open_mind_info_plot <- plot(open_mind_fit, type = "infotrace", facet =T, main = "Respectfulness")


#Test Information curve
extroversion_testinfo_plot <- plot(extroversion_fit, type = "infoSE", facet =T, main = "Sociability")

agreebleness_testinfo_plot <- plot(agreebleness_fit, type = "infoSE", facet =T, main = "Assertiveness")

conscientiousness_testinfo_plot <- plot(conscientiousness_fit, type = "infoSE", facet =T, main = "Compassion")
negative_emotionality_testinfo_plot <- plot(negative_emotionality_fit, type = "infoSE", facet =T, main = "Respectfulness")

open_mind_testinfo_plot <- plot(open_mind_fit, type = "infoSE", facet =T, main = "Respectfulness")


#OCC
extroversion_occ_plot <- plot(extroversion_fit, type = "trace", facet =T, main = "Sociability")

agreebleness_occ_plot <- plot(agreebleness_fit, type = "trace", facet =T, main = "Assertiveness")
conscientiousness_occ_plot <- plot(conscientiousness_fit, type = "trace", facet =T, main = "Compassion")
negative_emotionality_occ_plot <- plot(negative_emotionality_fit, type = "trace", facet =T, main = "Respectfulness")

open_mind_occ_plot <- plot(open_mind_fit, type = "trace", facet =T, main = "Respectfulness")


#Reliability
extroversion_rel_plot <- plot(extroversion_fit, type = "rxx", facet =T, main = "Sociability")

agreebleness_rel_plot <- plot(agreebleness_fit, type = "rxx", facet =T, main = "Assertiveness")
conscientiousness_rel_plot <- plot(conscientiousness_fit, type = "rxx", facet =T, main = "Compassion")
negative_emotionality_rel_plot <- plot(negative_emotionality_fit, type = "rxx", facet =T, main = "Respectfulness")

open_mind_rel_plot <- plot(open_mind_fit, type = "rxx", facet =T, main = "Respectfulness")
```

```{r equating, eval=FALSE}

library(plink)
library(ltm)


dif_data <- cbind(descriptives$Gender, bigfive)

dif_male <- dif_data %>% 
  subset(descriptives$Gender=="Male")

dif_female <- dif_data %>% 
  subset(descriptives$Gender=="Female")

dif_male_2 <- dif_male[,-1]
dif_female_2 <- dif_female[,-1]


extroversion_male <- dif_male_2 %>% dplyr::select(BF1, RBF16,BF46,RBF31, BF21, RBF36, RBF51,BF6, BF11,BF41, BF56,RBF26)


agreebleness_male <-  dif_male_2 %>% dplyr::select(BF2,RBF17,BF32,RBF47, BF7,RBF22,RBF37,BF52, RBF12,BF27,RBF42,BF57)

conscientiousness_male<-  dif_male_2 %>% dplyr::select(RBF3 , BF18 ,BF33 ,RBF48, RBF8 , RBF23, BF38 ,BF53, BF13,RBF28,BF43,RBF58)



negative_emotionality_male<-  dif_male_2 %>% dplyr::select(RBF4 ,BF19 ,BF34 ,RBF49,RBF9,RBF24,BF39,BF54,BF14 ,RBF29 ,RBF44,BF59 )


open_mind_male <-  dif_male_2 %>% dplyr::select(BF10,RBF25,BF40,RBF55, RBF5,BF20,BF35 , RBF50,BF15 ,RBF30 , RBF45  ,BF60)




extroversion_female <- dif_female_2 %>% dplyr::select(BF1, RBF16,BF46,RBF31, BF21, RBF36, RBF51,BF6, BF11,BF41, BF56,RBF26)


agreebleness_female <-  dif_female_2 %>% dplyr::select(BF2,RBF17,BF32,RBF47, BF7,RBF22,RBF37,BF52, RBF12,BF27,RBF42,BF57)

conscientiousness_female<-  dif_female_2 %>% dplyr::select(RBF3 , BF18 ,BF33 ,RBF48, RBF8 , RBF23, BF38 ,BF53, BF13,RBF28,BF43,RBF58)



negative_emotionality_female<-  dif_female_2 %>% dplyr::select(RBF4 ,BF19 ,BF34 ,RBF49,RBF9,RBF24,BF39,BF54,BF14 ,RBF29 ,RBF44,BF59 )


open_mind_female <-  dif_female_2 %>% dplyr::select(BF10,RBF25,BF40,RBF55, RBF5,BF20,BF35 , RBF50,BF15 ,RBF30 , RBF45  ,BF60)




common <- matrix(c(1:12, 1:12), 12, 2)  



#Exrtroversion
extroversion_male_ltm <- ltm::grm(extroversion_male , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)

extroversion_female_ltm <- ltm::grm(extroversion_female , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)


extroversion_male_plink <- plink::read.ltm(extroversion_male_ltm)
extroversion_female_plink <- plink::read.ltm(extroversion_female_ltm)

extroversion_combined_pars <- as.irt.pars(x = list(extroversion_male_plink@pars,extroversion_female_plink@pars), common = common, cat = list(extroversion_male_plink@cat, extroversion_female_plink@cat),  poly.mod = list(extroversion_male_plink@poly.mod, extroversion_female_plink@poly.mod))  
extroversion_liked_out <- plink(combined_pars, rescale = "MS", base.grp = 1)  
summary(extroversion_liked_out)  


extroversion_male_equated <- as.data.frame(extroversion_liked_out$pars@pars$group1)
extroversion_female_equated <- extroversion_liked_out$pars@pars$group2

extroversion_male_equated$ 

# agreebleness

agreebleness_male_ltm <- ltm::grm(agreebleness_male , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)

agreebleness_female_ltm <- ltm::grm(agreebleness_female , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)


agreebleness_male_plink <- plink::read.ltm(agreebleness_male_ltm)
agreebleness_female_plink <- plink::read.ltm(agreebleness_female_ltm)


agreebleness_combined_pars <- as.irt.pars(x = list(agreebleness_male_plink@pars,agreebleness_female_plink@pars), common = common, cat = list(agreebleness_male_plink@cat, agreebleness_female_plink@cat),  poly.mod = list(agreebleness_male_plink@poly.mod, agreebleness_female_plink@poly.mod))  
agreebleness_liked_out <- plink(combined_pars, rescale = "SL", base.grp = 1)  
summary(agreebleness_liked_out)  


# conscientiousness

conscientiousness_male_ltm <- ltm::grm(conscientiousness_male , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)

conscientiousness_female_ltm <- ltm::grm(conscientiousness_female , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)


conscientiousness_male_plink <- plink::read.ltm(conscientiousness_male_ltm)
conscientiousness_female_plink <- plink::read.ltm(conscientiousness_female_ltm)


conscientiousness_combined_pars <- as.irt.pars(x = list(conscientiousness_male_plink@pars,conscientiousness_female_plink@pars), common = common, cat = list(conscientiousness_male_plink@cat, conscientiousness_female_plink@cat),  poly.mod = list(conscientiousness_male_plink@poly.mod, conscientiousness_female_plink@poly.mod))  
conscientiousness_liked_out <- plink(combined_pars, rescale = "SL", base.grp = 1)  
summary(conscientiousness_liked_out)


#negative_emotionality
negative_emotionality_male_ltm <- ltm::grm(negative_emotionality_male , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)

negative_emotionality_female_ltm <- ltm::grm(negative_emotionality_female , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)


negative_emotionality_male_plink <- plink::read.ltm(negative_emotionality_male_ltm)
negative_emotionality_female_plink <- plink::read.ltm(negative_emotionality_female_ltm)


negative_emotionality_combined_pars <- as.irt.pars(x = list(negative_emotionality_male_plink@pars,negative_emotionality_female_plink@pars), common = common, cat = list(negative_emotionality_male_plink@cat, negative_emotionality_female_plink@cat),  poly.mod = list(negative_emotionality_male_plink@poly.mod, negative_emotionality_female_plink@poly.mod))  
negative_emotionality_liked_out <- plink(combined_pars, rescale = "SL", base.grp = 1)  
summary(negative_emotionality_liked_out)


#open_mind
open_mind_male_ltm <- ltm::grm(open_mind_male , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)

open_mind_female_ltm <- ltm::grm(open_mind_female , constrained = FALSE, IRT.param = TRUE, Hessian = FALSE)


open_mind_male_plink <- plink::read.ltm(open_mind_male_ltm)
open_mind_female_plink <- plink::read.ltm(open_mind_female_ltm)


open_mind_combined_pars <- as.irt.pars(x = list(open_mind_male_plink@pars,open_mind_female_plink@pars), common = common, cat = list(open_mind_male_plink@cat, open_mind_female_plink@cat),  poly.mod = list(open_mind_male_plink@poly.mod, open_mind_female_plink@poly.mod))  
open_mind_liked_out <- plink(combined_pars, rescale = "SL", base.grp = 1)  
summary(open_mind_liked_out)

```

```{r dif,eval=FALSE}
library(lordif)


extroversion_dif <- lordif(as.data.frame(extroversion), descriptives$Gender, criterion = "Chisqr", alpha = 0.05)


agreebleness_dif <- lordif(as.data.frame(agreebleness), descriptives$Gender,criterion = "Chisqr", alpha = 0.05)


conscientiousness_dif <- lordif(as.data.frame(conscientiousness), descriptives$Gender,  criterion = "Chisqr", alpha = 0.05)


negative_emotionality_dif <- lordif(as.data.frame(negative_emotionality), descriptives$Gender, criterion = "Chisqr", alpha = 0.05)

open_mind_dif <- lordif(as.data.frame(open_mind), descriptives$Gender, criterion = "Chisqr", alpha = 0.05)

adjusted_theta <- open_mind_dif$calib.sparse$theta


```


```{r validity, include=F}

Total_eyp <- eysenck %>% 
  rowwise() %>% 
  mutate(Total_p=sum(EYP10,EYP14,EYP22,EYP39,EYP18,EYP26, EYP28,EYP35,
                EYP43),
         Total_e=sum(EYP3,EYP7,EYP11,EYP15,EYP19,EYP23,EYP32,EYP36,EYP44,EYP48),
         Total_n= sum(EYP1,EYP5,EYP9,EYP13,EYP17,EYP21,EYP25,EYP30,EYP34,EYP38, EYP42,EYP46),
         Total_l= sum(EYP16,EYP45, EYP8, EYP12, EYP20, EYP24, EYP29, EYP33, EYP37, EYP41, EYP47))


validity_data <- bigfive %>% 
  rowwise() %>% 
  mutate(Extroversion = sum(BF1, BF46, RBF36, RBF51,BF6, BF11,BF41, BF56,RBF26, RBF16, BF21, RBF31),
         Agreebleness = sum(BF2,RBF17,BF32,RBF47, BF7,RBF22,RBF37,BF52, RBF12,BF27,RBF42,BF57),
         Conscientiousness = sum(RBF3 , BF18 ,BF33 ,RBF48, RBF8 , RBF23, BF38 ,BF53, BF13,RBF28,BF43,RBF58),
         NE= sum(RBF4 ,BF19 ,BF34 ,RBF49,RBF9,RBF24,BF39,BF54,BF14 ,RBF29 ,RBF44,BF59),
         OM= sum(BF10,RBF25,BF40,RBF55, RBF5,BF20,BF35 , RBF50,BF15 ,RBF30 , RBF45  ,BF60),
         Soc= sum(BF1, RBF16,BF46,RBF31),
         ASS=sum(BF21, RBF36, RBF51,BF6),
           EL=sum(BF11,BF41, BF56,RBF26),
         Compassion= sum(BF2,RBF17,BF32,RBF47),
         Respect= sum(BF7,RBF22,RBF37,BF52),
        Trust= sum(RBF12,BF27,RBF42,BF57),
        Organization= sum(RBF3 , BF18 ,BF33 ,RBF48),
         Productiveness= sum(RBF8 , RBF23, BF38 ,BF53),
         Responsibility= sum(BF13,RBF28,BF43,RBF58),
         Anxiety= sum(RBF4 ,BF19 ,BF34 ,RBF49),
         DepressionEV= sum(RBF9,RBF24,BF39,BF54),
        EV=sum(BF14 ,RBF29 ,RBF44,BF59),
         IC= sum(BF10,RBF25,BF40,RBF55),
         AS= sum(RBF5,BF20,BF35 , RBF50),
         CI= sum(BF15 ,RBF30 , RBF45  ,BF60),
        Extroversion_s=sum(RBF16, BF46, BF21, RBF36, BF41, RBF11),
        agreebleness_s=sum(RBF17, BF32, BF52, RBF22, RBF12, BF57),
          cons_s=sum( BF33, RBF3,RBF23, BF38, RBF58, BF43),
          ne_s=sum(BF34, RBF4, BF39, RBF24, RBF29, BF59),
          om_s=sum(RBF25, BF10, BF20,RBF50,RBF30, BF15),
        Extroversion_xs=sum(RBF16,  BF21,  BF41),
        agreebleness_xs=sum(RBF17, BF52,RBF12),
          cons_xs=sum( BF33, RBF23,  RBF58),
          ne_xs=sum(BF34, BF39,  RBF29),
          om_xs=sum(RBF25,  BF20,RBF30))

validity_data$Total_P <- Total_eyp$Total_p 
validity_data$Total_E<- Total_eyp$Total_e 
validity_data$Total_N<- Total_eyp$Total_n 
validity_data$Total_L<- Total_eyp$Total_l 

validity.cor <- validity_data %>% 
  dplyr::select(Total_P:Total_L, Extroversion:CI)
domain_cor <- validity_data %>% 
  dplyr::select(Extroversion:OM)
short_forms <- validity_data %>% 
  dplyr::select(Extroversion:OM, Extroversion_s:om_s, Extroversion_xs:om_xs)


means_descriptives <- cbind(descriptives$Gender,validity.cor)
colnames(means_descriptives)[1] <- "Gender"

means_des_summary <- means_descriptives %>%
  tbl_summary(
    by = Gender,
    type = list(Total_P ~ 'continuous'
                ),
    statistic = list(all_continuous() ~ "{mean} ({sd})", 
                     all_categorical() ~ "{n} ({p}%)"),
    
    digits = all_continuous() ~ 2,
    
    missing = "no",
    sort = all_categorical() ~ "frequency",
    ) %>% add_overall() %>% bold_labels() %>% 
modify_header(label ~ "**Variable**") %>% 
  modify_caption("Summary Mean")  %>% 
  add_p() %>% 
  add_q()
  

```


```{r correlationfunc, include =F}
glrstab<- function(x, export=FALSE) {
 
 r <-corr.test(x)$r	#taking just the correlation matrix; no N, or p
 p <-corr.test(x)$p	#taking the p*s
 
#define notions for significance levels
 mystars <- ifelse(p < .001, "**"
                   , ifelse(p < .01, "**"
                            , ifelse(p < .05, "*"
                                     , ifelse(p < .10, "+", " "))))
 
 #round r, define new matrix Rnew with the correlations from rnd and paste mystars
 rnd  <- papaja::printnum(r, gt1 = FALSE, digits = 2)  #round, drop leading 0 - Thanks CRSH!								                     
 Rnew <- matrix(paste(rnd, mystars, sep=""), ncol=ncol(rnd)) 
 
  #remove 1.0 correlations from diagonal  and set the strings
 diag(Rnew) <- ''		
 Rnew[upper.tri(Rnew)] <- ''								                	
 
 rownames(Rnew) <- paste(1:ncol(rnd), colnames(rnd), sep=" ")         #define number and name
 colnames(Rnew) <- paste(1:ncol(rnd), "", sep="") 			       #define number
 
#fun-part: we trim the top half 
 Rnew[upper.tri(Rnew)] <- ''			
 Rnew
 
 #Rnew <- cbind(round(describe(x)[,3:4],2), Rnew)		     #describe x, M sD - put them in the matrix
 #colnames(Rnew)[1:2] <- c("M","SD")					      		#Beschriftung der neuen Spalten
 Rnew <- Rnew[,1:(ncol(Rnew)-1)]							        	#delete the last column (ugly)
 
 #export to clipboard
 
   if (export==TRUE){
   result<-write.table(Rnew
                       , "clipboard"
                       , sep=";"
                       , row.names=FALSE)
 }
 else result <- Rnew
 return(result)
 
}

```

```{r correlations, include =F}
Cor <-glrstab(validity.cor) #the function in action!

cor.tab <- as_tibble(cor(validity.cor))
domain_cor <- glrstab(domain_cor)
short_form_cor <- glrstab(short_forms)
short_form_cor_tab <- as_tibble(cor(short_forms ))

```

```{r tabvalidity,  results='asis'}
papaja::apa_table(Cor, escape  = FALSE
                , caption = "Correlation matrix of the main variables"
                , note    = "**p < .001", landscape = T)
```

```{r tabvalidity2,  results='asis'}
papaja::apa_table(short_form_cor, escape  = FALSE
                , caption = "Correlation matrix of scales"
                , note    = "**p < .001", landscape = T)
```

```{r tabvalidity3,  results='asis'}
papaja::apa_table(domain_cor, escape  = FALSE
                , caption = "Correlation matrix of the domains"
                , note    = "**p < .001", landscape = T)
```


# Discussion


\newpage

# References

::: {#refs custom-style="Bibliography"}
:::
